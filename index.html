<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filialbesuch Dokumentation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 8px;
            -webkit-overflow-scrolling: touch;
            -webkit-text-size-adjust: 100%;
        }

        .container {
            width: 100%;
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 16px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 20px 16px;
            text-align: center;
            position: relative;
        }

        .header-content {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            flex-wrap: wrap;
        }

        .budni-logo {
            width: 60px;
            height: 40px;
            flex-shrink: 0;
        }

        .header-text {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
        }

        .header h1 {
            font-size: 1.5rem;
            margin-bottom: 6px;
            font-weight: 600;
            line-height: 1.2;
        }

        .header p {
            opacity: 0.9;
            font-size: 0.9rem;
            line-height: 1.3;
        }

        .content {
            padding: 16px;
        }

        .visit-info {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 20px;
            padding: 16px;
            background: #f8f9fa;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 0.95rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .input-group input,
        .input-group select {
            width: 100%;
            padding: 14px 12px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            appearance: none;
            -webkit-appearance: none;
            min-height: 50px;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }

        .input-group select {
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 12px center;
            background-size: 18px;
            padding-right: 40px;
        }

        .competitor-option {
            background-repeat: no-repeat;
            background-position: left 12px center;
            background-size: 20px 20px;
            padding-left: 40px;
        }

        .validation-error {
            border-color: #e74c3c !important;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.15) !important;
        }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px 16px;
            border-radius: 8px;
            margin: 16px 0;
            text-align: center;
            display: none;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid #f5c6cb;
        }

        .selection-info {
            background: #d1ecf1;
            color: #0c5460;
            padding: 10px 16px;
            border-radius: 8px;
            margin: 12px 0;
            text-align: center;
            font-size: 0.85rem;
            border: 1px solid #bee5eb;
        }

        .entry-item {
            background: #fff;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 16px;
            position: relative;
            transition: all 0.3s ease;
        }

        .entry-item:hover {
            border-color: #667eea;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.15);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            flex-wrap: wrap;
            gap: 8px;
        }

        .entry-number {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            font-size: 0.9rem;
            flex-shrink: 0;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 8px 12px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            min-height: 36px;
            display: flex;
            align-items: center;
            gap: 4px;
            flex-shrink: 0;
        }

        .delete-btn:hover,
        .delete-btn:active {
            background: #c0392b;
            transform: scale(0.95);
        }

        .text-area {
            width: 100%;
            min-height: 120px;
            padding: 14px;
            border: 2px solid #e1e8ed;
            border-radius: 10px;
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            transition: all 0.3s ease;
            margin-bottom: 16px;
            line-height: 1.4;
        }

        .text-area:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.15);
        }

        .image-upload {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            width: 44px;
            height: 44px;
            border: 2px solid #bdc3c7;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            margin-bottom: 16px;
            position: relative;
        }

        .image-upload:hover,
        .image-upload:active {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.05);
        }

        .image-upload.drag-over {
            border-color: #667eea;
            background: #e8f2ff;
            transform: scale(1.1);
        }

        .image-upload-icon {
            font-size: 20px;
            color: #667eea;
        }

        .image-upload-label {
            font-size: 0.8rem;
            color: #7f8c8d;
            margin-left: 8px;
            font-weight: 500;
        }

        .image-upload-container {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px;
            margin-top: 16px;
        }

        .image-item {
            position: relative;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 3px 12px rgba(0,0,0,0.1);
            aspect-ratio: 1;
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .image-item img:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        /* Lightbox für Bildvergrößerung */
        .lightbox {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .lightbox.active {
            display: flex;
        }

        .lightbox-content {
            position: relative;
            max-width: 90%;
            max-height: 90%;
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
        }

        .lightbox-img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            display: block;
        }

        .lightbox-close {
            position: absolute;
            top: 15px;
            right: 15px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 20px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .lightbox-close:hover {
            background: rgba(0, 0, 0, 0.9);
            transform: scale(1.1);
        }

        .lightbox-info {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: linear-gradient(transparent, rgba(0, 0, 0, 0.7));
            color: white;
            padding: 20px;
            text-align: center;
        }

        /* Mobile Lightbox Optimierungen */
        @media (max-width: 768px) {
            .lightbox-content {
                max-width: 95%;
                max-height: 95%;
            }
            
            .lightbox-close {
                top: 10px;
                right: 10px;
                width: 35px;
                height: 35px;
                font-size: 18px;
            }
            
            .lightbox-info {
                padding: 15px;
                font-size: 0.9rem;
            }
        }

        .image-remove {
            position: absolute;
            top: 6px;
            right: 6px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            font-size: 14px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .image-remove:hover,
        .image-remove:active {
            background: #c0392b;
            transform: scale(1.05);
        }

        .add-entry-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 16px 24px;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            margin-bottom: 24px;
            min-height: 54px;
        }

        .add-entry-btn:hover,
        .add-entry-btn:active {
            transform: scale(0.98);
            box-shadow: 0 6px 20px rgba(39, 174, 96, 0.3);
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 12px;
            justify-content: center;
        }

        .btn {
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn:hover,
        .btn:active {
            transform: scale(0.98);
            box-shadow: 0 6px 20px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px 16px;
            color: #667eea;
            font-weight: 600;
            font-size: 1rem;
            background: #f0f4ff;
            border-radius: 12px;
            margin: 16px 0;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 16px;
            border-radius: 12px;
            margin: 16px 0;
            text-align: center;
            display: none;
            font-weight: 600;
            font-size: 1rem;
        }

        /* iPhone Safari spezifische Fixes */
        @supports (-webkit-touch-callout: none) {
            .input-group input,
            .input-group select,
            .text-area {
                font-size: 16px; /* Verhindert Zoom beim Fokus */
                transform: translateZ(0); /* Hardware-Beschleunigung */
            }
            
            .container {
                -webkit-transform: translateZ(0);
            }
        }

        /* iPhone SE und kleine Bildschirme */
        @media (max-width: 375px) {
            body {
                padding: 4px;
            }
            
            .content {
                padding: 12px;
            }
            
            .visit-info {
                padding: 12px;
                gap: 12px;
            }
            
            .entry-item {
                padding: 12px;
            }
            
            .header {
                padding: 16px 12px;
            }
            
            .header h1 {
                font-size: 1.3rem;
            }
            
            .budni-logo {
                width: 50px;
                height: 32px;
            }
            
            .header-content {
                gap: 8px;
            }
            
            .entry-header-left {
                gap: 8px;
            }
            
            .image-upload {
                width: 32px;
                height: 32px;
            }
            
            .image-upload-icon {
                font-size: 14px;
            }
            
            .delete-btn {
                width: 32px;
                height: 32px;
                font-size: 14px;
            }
            
            .image-preview {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
                gap: 8px;
            }
        }

        /* iPhone Pro Max und große Bildschirme */
        @media (min-width: 414px) {
            .container {
                max-width: 95%;
            }
            
            .image-preview {
                grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            }
        }

        /* Tablet Portrait */
        @media (min-width: 768px) {
            body {
                padding: 16px;
            }
            
            .container {
                max-width: 600px;
            }
            
            .visit-info {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 16px;
            }
            
            .actions {
                flex-direction: row;
            }
            
            .content {
                padding: 24px;
            }
        }

        /* Desktop */
        @media (min-width: 1024px) {
            body {
                padding: 20px;
            }
            
            .container {
                max-width: 800px;
            }
            
            .content {
                padding: 30px;
            }
            
            .header {
                padding: 30px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
            
            .budni-logo {
                width: 80px;
                height: 52px;
            }
            
            .header-content {
                gap: 16px;
            }
        }

        /* Accessibility */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Dark Mode */
        @media (prefers-color-scheme: dark) {
            .container {
                background: #1a1a1a;
                color: #ffffff;
            }
            
            .visit-info {
                background: #2d2d2d;
            }
            
            .entry-item {
                background: #2d2d2d;
                border-color: #404040;
            }
            
            .input-group input,
            .input-group select,
            .text-area {
                background: #2d2d2d;
                border-color: #404040;
                color: #ffffff;
            }
            
            .image-upload {
                background: #2d2d2d;
                border-color: #404040;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-content">
                <svg class="budni-logo" viewBox="0 0 140 90" xmlns="http://www.w3.org/2000/svg">
                    <!-- Türkis/Cyan Kreis links hinten -->
                    <circle cx="45" cy="45" r="35" fill="#00BCD4"/>
                    <!-- Orange/Koralle Kreis rechts hinten -->
                    <circle cx="95" cy="45" r="35" fill="#FF6B6B"/>
                    <!-- Hauptkreis dunkelblau vorne (überlappt beide) -->
                    <circle cx="70" cy="45" r="35" fill="#2E4BC6"/>
                    <!-- budni Text in weiß -->
                    <text x="70" y="52" font-family="Arial, sans-serif" font-size="16" font-weight="300" fill="white" text-anchor="middle">budni</text>
                    <!-- Punkt nach dem i -->
                    <circle cx="88" cy="39" r="1.8" fill="white"/>
                </svg>
                <div class="header-text">
                    <h1>Filialbesuch Dokumentation</h1>
                    <p>Erfassen Sie Ihre Beobachtungen und Notizen strukturiert</p>
                </div>
            </div>
        </div>
        
        <div class="content">
            <div class="visit-info">
                <div class="input-group">
                    <label for="visitDate">📅 Besuchsdatum:</label>
                    <input type="date" id="visitDate">
                </div>
                <div class="input-group">
                    <label for="branchName">🏪 Filialname:</label>
                    <select id="branchName">
                        <option value="">Filiale auswählen...</option>
                        <option value="Ahrensburg / Hamburger Str. 4-8 /(0727)">Ahrensburg / Hamburger Str. 4-8 /(0727)</option>
                        <option value="Ahrensburg / Rathausplatz 15 /(0174)">Ahrensburg / Rathausplatz 15 /(0174)</option>
                        <option value="Alsterdorf / Alsterdorfer Str. 206 /(0792)">Alsterdorf / Alsterdorfer Str. 206 /(0792)</option>
                        <option value="Altona-Altstadt / Holstenstraße 111 /(0193)">Altona-Altstadt / Holstenstraße 111 /(0193)</option>
                        <option value="Altona-Altstadt / Neue Große Bergstraße 18 /(0214)">Altona-Altstadt / Neue Große Bergstraße 18 /(0214)</option>
                        <option value="Altstadt / Bergstrasse 16 /(0101)">Altstadt / Bergstrasse 16 /(0101)</option>
                        <option value="Ammersbek / Hamburger Straße 101 /(0276)">Ammersbek / Hamburger Straße 101 /(0276)</option>
                        <option value="Apensen / Beckdorfer Straße 18 /(0190)">Apensen / Beckdorfer Straße 18 /(0190)</option>
                        <option value="Bad Oldesloe / Lübecker Straße 23-25 /(0230)">Bad Oldesloe / Lübecker Straße 23-25 /(0230)</option>
                        <option value="Bad Segeberg / Ziegelstrasse 105-107 /(0138)">Bad Segeberg / Ziegelstrasse 105-107 /(0138)</option>
                        <option value="Bahrenfeld / Gasstraße 6b /(0261)">Bahrenfeld / Gasstraße 6b /(0261)</option>
                        <option value="Bahrenfeld / Osdorfer Weg 106 /(0148)">Bahrenfeld / Osdorfer Weg 106 /(0148)</option>
                        <option value="Barendorf / Im Stadtkamp 1 /(0256)">Barendorf / Im Stadtkamp 1 /(0256)</option>
                        <option value="Bargteheide / Rathausstraße 13-15 /(0717)">Bargteheide / Rathausstraße 13-15 /(0717)</option>
                        <option value="Barmbek-Nord / Alter Güterbahnhof 2 /(0241)">Barmbek-Nord / Alter Güterbahnhof 2 /(0241)</option>
                        <option value="Barmbek-Nord / Fuhlsbüttler Str. 107-109 /(0301)">Barmbek-Nord / Fuhlsbüttler Str. 107-109 /(0301)</option>
                        <option value="Barmbek-Nord / Fuhlsbüttler Straße 164 /(0181)">Barmbek-Nord / Fuhlsbüttler Straße 164 /(0181)</option>
                        <option value="Barmbek-Nord / Fuhlsbüttler Straße 401 /(0164)">Barmbek-Nord / Fuhlsbüttler Straße 401 /(0164)</option>
                        <option value="Barmbek-Süd / Hamburger Str. 47-49 /(0764)">Barmbek-Süd / Hamburger Str. 47-49 /(0764)</option>
                        <option value="Barmbek-Süd / Mozartstraße 16 /(0168)">Barmbek-Süd / Mozartstraße 16 /(0168)</option>
                        <option value="Barsbüttel / Am Akku 9 /(0234)">Barsbüttel / Am Akku 9 /(0234)</option>
                        <option value="Bergedorf / Bergedorfer Str. 133 /(0407)">Bergedorf / Bergedorfer Str. 133 /(0407)</option>
                        <option value="Bergedorf / Friedrich-Frank-Bogen 166 /(0250)">Bergedorf / Friedrich-Frank-Bogen 166 /(0250)</option>
                        <option value="Bergedorf / Kupferhof 7 /(0757)">Bergedorf / Kupferhof 7 /(0757)</option>
                        <option value="Bergstedt / Wohldorfer Damm 1- 1a /(0253)">Bergstedt / Wohldorfer Damm 1- 1a /(0253)</option>
                        <option value="Berlin / Bundesalle 86/89 /0555">Berlin / Bundesalle 86/89 /0555</option>
                        <option value="Berlin / Frankfurter Allee 35-37 /0552">Berlin / Frankfurter Allee 35-37 /0552</option>
                        <option value="Berlin / Friedenstraße 90 /0556">Berlin / Friedenstraße 90 /0556</option>
                        <option value="Berlin / Friedrichstraße 149 /0554">Berlin / Friedrichstraße 149 /0554</option>
                        <option value="Berlin / Güntzelstraße 48 /0553">Berlin / Güntzelstraße 48 /0553</option>
                        <option value="Berlin / Martin Luther Straße 48 /0560">Berlin / Martin Luther Straße 48 /0560</option>
                        <option value="Berlin / Rankestraße 33-34 /0557">Berlin / Rankestraße 33-34 /0557</option>
                        <option value="Berlin / Revaler Straße 33 /0561">Berlin / Revaler Straße 33 /0561</option>
                        <option value="Berlin / Schönhauser Allee 12 /0551">Berlin / Schönhauser Allee 12 /0551</option>
                        <option value="Berlin / Schönhauser Allee 120 /0550">Berlin / Schönhauser Allee 120 /0550</option>
                        <option value="Berlin / Wilmersdorfer Straße 60 /0558">Berlin / Wilmersdorfer Straße 60 /0558</option>
                        <option value="Billstedt / Billstedter Platz 2 /(0183)">Billstedt / Billstedter Platz 2 /(0183)</option>
                        <option value="Blankenese / Propst-Paulsen-Str. 2 /(0208)">Blankenese / Propst-Paulsen-Str. 2 /(0208)</option>
                        <option value="Blankenese / Sülldorfer Kirchenweg 1-3 /(0761)">Blankenese / Sülldorfer Kirchenweg 1-3 /(0761)</option>
                        <option value="Börnsen / Hermann-Wöhlke-Weg 2 /(0191)">Börnsen / Hermann-Wöhlke-Weg 2 /(0191)</option>
                        <option value="Bramfeld / Bramfelder Chaussee 230 /(0165)">Bramfeld / Bramfelder Chaussee 230 /(0165)</option>
                        <option value="Bramfeld / Pezolddamm 147 /(0213)">Bramfeld / Pezolddamm 147 /(0213)</option>
                        <option value="Büchen / Schlickweg 2 /(0287)">Büchen / Schlickweg 2 /(0287)</option>
                        <option value="Buchholz / Breite Str. 5 /(0707)">Buchholz / Breite Str. 5 /(0707)</option>
                        <option value="Buchholz / Soltauer Straße 93 /(0196)">Buchholz / Soltauer Straße 93 /(0196)</option>
                        <option value="Buxtehude / Stader Straße 2 /(0788)">Buxtehude / Stader Straße 2 /(0788)</option>
                        <option value="Buxtehude / Zwischen den Brücken 1 /(0748)">Buxtehude / Zwischen den Brücken 1 /(0748)</option>
                        <option value="Dollern / Am Buschteich 26 /(0255)">Dollern / Am Buschteich 26 /(0255)</option>
                        <option value="Duvenstedt / Poppenbüttler Chaussee 36 /(0155)">Duvenstedt / Poppenbüttler Chaussee 36 /(0155)</option>
                        <option value="Eidelstedt / Eidelstedter Platz 1 /(0731)">Eidelstedt / Eidelstedter Platz 1 /(0731)</option>
                        <option value="Eilbek / Conventstraße 8-10 /(0262)">Eilbek / Conventstraße 8-10 /(0262)</option>
                        <option value="Eilbek / Landwehr 34 /(0713)">Eilbek / Landwehr 34 /(0713)</option>
                        <option value="Eimsbüttel / Eimsbütteler Chaussee 85 /(0216)">Eimsbüttel / Eimsbütteler Chaussee 85 /(0216)</option>
                        <option value="Eimsbüttel / Müggenkampstraße 4 /(0775)">Eimsbüttel / Müggenkampstraße 4 /(0775)</option>
                        <option value="Eimsbüttel / Osterstr. 1 /(0122)">Eimsbüttel / Osterstr. 1 /(0122)</option>
                        <option value="Eimsbüttel / Osterstr. 95 /(0203)">Eimsbüttel / Osterstr. 95 /(0203)</option>
                        <option value="Eppendorf / Eppendorfer Baum 39 /(0602)">Eppendorf / Eppendorfer Baum 39 /(0602)</option>
                        <option value="Eppendorf / Eppendorfer Landstr. 67 /(0711)">Eppendorf / Eppendorfer Landstr. 67 /(0711)</option>
                        <option value="Eppendorf / Eppendorfer Landstrasse 77 /(0145)">Eppendorf / Eppendorfer Landstrasse 77 /(0145)</option>
                        <option value="Eppendorf / Martinistraße 64 /(0200)">Eppendorf / Martinistraße 64 /(0200)</option>
                        <option value="Farmsen-Berne / Berner Heerweg 173-175 /(0603)">Farmsen-Berne / Berner Heerweg 173-175 /(0603)</option>
                        <option value="Finkenwerder / Steendiek 43 /(0708)">Finkenwerder / Steendiek 43 /(0708)</option>
                        <option value="Fuhlsbüttel / Erdkampsweg 47-49 /(0755)">Fuhlsbüttel / Erdkampsweg 47-49 /(0755)</option>
                        <option value="Geesthacht / Norderstraße 16 /(0270)">Geesthacht / Norderstraße 16 /(0270)</option>
                        <option value="Glinde / Markt 3 /(0410)">Glinde / Markt 3 /(0410)</option>
                        <option value="Groß Borstel / Borsteler Chaussee 111-113 /(0747)">Groß Borstel / Borsteler Chaussee 111-113 /(0747)</option>
                        <option value="Gross Flottbek / Waitzstrasse 29 /(0140)">Gross Flottbek / Waitzstrasse 29 /(0140)</option>
                        <option value="Grosshansdorf / Eilbergweg 11 /(0218)">Grosshansdorf / Eilbergweg 11 /(0218)</option>
                        <option value="HafenCity / Überseeboulevard 7 /(0281)">HafenCity / Überseeboulevard 7 /(0281)</option>
                        <option value="Halstenbek / Seestrasse 250 /(0147)">Halstenbek / Seestrasse 250 /(0147)</option>
                        <option value="Hamm / Hammer Landstraße 84 /(0279)">Hamm / Hammer Landstraße 84 /(0279)</option>
                        <option value="Hamm-Mitte / Droopweg 25 /(0152)">Hamm-Mitte / Droopweg 25 /(0152)</option>
                        <option value="Hamm-Nord / Hammer Steindamm 72-74 /(0192)">Hamm-Nord / Hammer Steindamm 72-74 /(0192)</option>
                        <option value="Hammerbrook / Sonninstraße 1-5 /(0278)">Hammerbrook / Sonninstraße 1-5 /(0278)</option>
                        <option value="Hanstedt / Winsener Straße 1-3 /(0264)">Hanstedt / Winsener Straße 1-3 /(0264)</option>
                        <option value="Harburg / Hannoversche Straße 86 /(0273)">Harburg / Hannoversche Straße 86 /(0273)</option>
                        <option value="Harburg / Lüneburger Str. 39 /(0737)">Harburg / Lüneburger Str. 39 /(0737)</option>
                        <option value="Harburg / Sand 10 /(0501)">Harburg / Sand 10 /(0501)</option>
                        <option value="Harsefeld / Buxtehuder Str. 11 /(0735)">Harsefeld / Buxtehuder Str. 11 /(0735)</option>
                        <option value="Harvestehude / Grindelberg 7 /(0151)">Harvestehude / Grindelberg 7 /(0151)</option>
                        <option value="Heimfeld / Heimfelder Str. 46 /(0766)">Heimfeld / Heimfelder Str. 46 /(0766)</option>
                        <option value="Heimfeld / Stader Straße 136 /(0231)">Heimfeld / Stader Straße 136 /(0231)</option>
                        <option value="Henstedt-Ulzburg / Dammstücken 29-33 /(0274)">Henstedt-Ulzburg / Dammstücken 29-33 /(0274)</option>
                        <option value="Hittfeld / Kirchstrasse 26 /(0172)">Hittfeld / Kirchstrasse 26 /(0172)</option>
                        <option value="Hoheluft-Ost / Eppendorfer Baum 42 /(0804)">Hoheluft-Ost / Eppendorfer Baum 42 /(0804)</option>
                        <option value="Hoheluft-Ost / Hoheluftchaussee 52 /(0212)">Hoheluft-Ost / Hoheluftchaussee 52 /(0212)</option>
                        <option value="Horn / Graßmannweg 6-13 /(0219)">Horn / Graßmannweg 6-13 /(0219)</option>
                        <option value="Horn / Rennbahnstr. 30-38 /(0723)">Horn / Rennbahnstr. 30-38 /(0723)</option>
                        <option value="Hummelsbüttel / Hummelsbüttler Hauptstr. 62 /(0127)">Hummelsbüttel / Hummelsbüttler Hauptstr. 62 /(0127)</option>
                        <option value="Jesteburg / Brückenstraße 11 /(0217)">Jesteburg / Brückenstraße 11 /(0217)</option>
                        <option value="Kaltenkirchen / Am Bahnhof 2-12 /(0763)">Kaltenkirchen / Am Bahnhof 2-12 /(0763)</option>
                        <option value="Keitum / Keitumer Landstraße 10a-c /(0801)">Keitum / Keitumer Landstraße 10a-c /(0801)</option>
                        <option value="Langenhorn / Krohnstieg 41-43 /(0269)">Langenhorn / Krohnstieg 41-43 /(0269)</option>
                        <option value="Langenhorn / Langenhorner Chaussee 666 /(0238)">Langenhorn / Langenhorner Chaussee 666 /(0238)</option>
                        <option value="Lohbrügge / Am Beckerkamp 17 /(0291)">Lohbrügge / Am Beckerkamp 17 /(0291)</option>
                        <option value="Lohbrügge / Heidhorst 4 /(0226)">Lohbrügge / Heidhorst 4 /(0226)</option>
                        <option value="Lokstedt / Vogt-Wells-Straße 6 /(0229)">Lokstedt / Vogt-Wells-Straße 6 /(0229)</option>
                        <option value="Lübeck / Heiligen-Geist-Kamp 4 /(0235)">Lübeck / Heiligen-Geist-Kamp 4 /(0235)</option>
                        <option value="Lübeck / Mühlenstraße 22-24 /(0286)">Lübeck / Mühlenstraße 22-24 /(0286)</option>
                        <option value="Lüneburg / Am Sande 50 /(0738)">Lüneburg / Am Sande 50 /(0738)</option>
                        <option value="Lüneburg / Bei der Keulahütte 1 /(0793)">Lüneburg / Bei der Keulahütte 1 /(0793)</option>
                        <option value="Lüneburg / Feldstrasse 1 /(0128)">Lüneburg / Feldstrasse 1 /(0128)</option>
                        <option value="Lurup / Elbgaustrasse 128 /(0153)">Lurup / Elbgaustrasse 128 /(0153)</option>
                        <option value="Lurup / Luruper Hauptstraße 272a /(0194)">Lurup / Luruper Hauptstraße 272a /(0194)</option>
                        <option value="Marienthal / Rennbahnstrasse 135 /(0136)">Marienthal / Rennbahnstrasse 135 /(0136)</option>
                        <option value="Marmstorf / Ernst-Bergeest-Weg 57 a /(0705)">Marmstorf / Ernst-Bergeest-Weg 57 a /(0705)</option>
                        <option value="Maschen / Schulstraße 38 /(0237)">Maschen / Schulstraße 38 /(0237)</option>
                        <option value="Meckelfeld / Am Saal 20 /(0123)">Meckelfeld / Am Saal 20 /(0123)</option>
                        <option value="Mölln / Grambeker Weg 91-93 /(0124)">Mölln / Grambeker Weg 91-93 /(0124)</option>
                        <option value="Mundsburg Center / Hamburger Straße 1-15 /(0179)">Mundsburg Center / Hamburger Straße 1-15 /(0179)</option>
                        <option value="Nahe / Segeberger Strasse 30 /(0173)">Nahe / Segeberger Strasse 30 /(0173)</option>
                        <option value="Neu Wulmstorf / Wulmstorfer Wiesen 2a /(0185)">Neu Wulmstorf / Wulmstorfer Wiesen 2a /(0185)</option>
                        <option value="Neuengamme / Heinrich-Stubbe-Weg 13-15 /(0254)">Neuengamme / Heinrich-Stubbe-Weg 13-15 /(0254)</option>
                        <option value="Neugraben-Fischbek / Lütt Enn 3 /(0505)">Neugraben-Fischbek / Lütt Enn 3 /(0505)</option>
                        <option value="Neustadt / Dammtorstr. 33-35 /(0784)">Neustadt / Dammtorstr. 33-35 /(0784)</option>
                        <option value="Neustadt / Wexstr. 25 /(0760)">Neustadt / Wexstr. 25 /(0760)</option>
                        <option value="Neuwiedenthal / Rehrstieg 28 /(0225)">Neuwiedenthal / Rehrstieg 28 /(0225)</option>
                        <option value="Niedermarschacht / Elbuferstrasse 116 /(0159)">Niedermarschacht / Elbuferstrasse 116 /(0159)</option>
                        <option value="Niendorf / Paul-Sorge-Str. 8 /(0730)">Niendorf / Paul-Sorge-Str. 8 /(0730)</option>
                        <option value="Niendorf / Wagrier Weg 2-8 /(0149)">Niendorf / Wagrier Weg 2-8 /(0149)</option>
                        <option value="Nienstedten / Nienstedtener Straße 2e /(0215)">Nienstedten / Nienstedtener Straße 2e /(0215)</option>
                        <option value="Norderstedt / Berliner Allee 42 /(0753)">Norderstedt / Berliner Allee 42 /(0753)</option>
                        <option value="Norderstedt / Rathausallee 31a/33a /(0252)">Norderstedt / Rathausallee 31a/33a /(0252)</option>
                        <option value="Norderstedt / Schmuggelstieg 6 /(0309)">Norderstedt / Schmuggelstieg 6 /(0309)</option>
                        <option value="Norderstedt / Ulzburger Strasse 360 /(0150)">Norderstedt / Ulzburger Strasse 360 /(0150)</option>
                        <option value="Osdorf / Osdorfer Landstrasse 131-135 /(0129)">Osdorf / Osdorfer Landstrasse 131-135 /(0129)</option>
                        <option value="Osdorf / Rugenbarg 18 /(0239)">Osdorf / Rugenbarg 18 /(0239)</option>
                        <option value="Oststeinbek / Möllner Landstrasse 30 /(0144)">Oststeinbek / Möllner Landstrasse 30 /(0144)</option>
                        <option value="Othmarschen / Jürgen-Töpfer-Straße 18 /(0224)">Othmarschen / Jürgen-Töpfer-Straße 18 /(0224)</option>
                        <option value="Ottensen / Bahrenfelder Straße 134 /(0266)">Ottensen / Bahrenfelder Straße 134 /(0266)</option>
                        <option value="Ottensen / Ottenser Hauptstraße 10 /(0187)">Ottensen / Ottenser Hauptstraße 10 /(0187)</option>
                        <option value="Pinneberg / Richard-Köhn-Str. 1 /(0796)">Pinneberg / Richard-Köhn-Str. 1 /(0796)</option>
                        <option value="Poppenbüttel / Heegbarg 31 /(0762)">Poppenbüttel / Heegbarg 31 /(0762)</option>
                        <option value="Poppenbüttel / Moorhof 7a /(0781)">Poppenbüttel / Moorhof 7a /(0781)</option>
                        <option value="Poppenbüttel / Poppenbütteler Bogen 98 /(0289)">Poppenbüttel / Poppenbütteler Bogen 98 /(0289)</option>
                        <option value="Quickborn / Bahnhofstraße 104 /(0746)">Quickborn / Bahnhofstraße 104 /(0746)</option>
                        <option value="Rahlstedt / Bargteheider Straße 20-22 /(0220)">Rahlstedt / Bargteheider Straße 20-22 /(0220)</option>
                        <option value="Rahlstedt / Meiendorfer Strasse 89 /(0135)">Rahlstedt / Meiendorfer Strasse 89 /(0135)</option>
                        <option value="Rahlstedt / Rahlstedter Bahnhofstrasse 17 /(0176)">Rahlstedt / Rahlstedter Bahnhofstrasse 17 /(0176)</option>
                        <option value="Rahlstedt / Scharbeutzer Straße 102a-c /(0236)">Rahlstedt / Scharbeutzer Straße 102a-c /(0236)</option>
                        <option value="Rahlstedt / Schweriner Strasse 8-12 /(0141)">Rahlstedt / Schweriner Strasse 8-12 /(0141)</option>
                        <option value="Reinbek / Am Ladenzentrum 7 /(0126)">Reinbek / Am Ladenzentrum 7 /(0126)</option>
                        <option value="Reinbek / Sachsenwaldstr. 20 /(0791)">Reinbek / Sachsenwaldstr. 20 /(0791)</option>
                        <option value="Rellingen / Hauptstrasse 105 /(0133)">Rellingen / Hauptstrasse 105 /(0133)</option>
                        <option value="Rissen / Wedeler Landstraße 56 /(0242)">Rissen / Wedeler Landstraße 56 /(0242)</option>
                        <option value="Rothenburgsort / Lindleystraße 2 /(0782)">Rothenburgsort / Lindleystraße 2 /(0782)</option>
                        <option value="Rotherbaum / Grindelallee 110-114 /(0201)">Rotherbaum / Grindelallee 110-114 /(0201)</option>
                        <option value="Rotherbaum / Milchstraße 1 /(0785)">Rotherbaum / Milchstraße 1 /(0785)</option>
                        <option value="Rotherbaum / Mittelweg 126 /(0805)">Rotherbaum / Mittelweg 126 /(0805)</option>
                        <option value="Sasel / Saseler Markt 14a /(0228)">Sasel / Saseler Markt 14a /(0228)</option>
                        <option value="Schenefeld / Industriestraße 1 /(0188)">Schenefeld / Industriestraße 1 /(0188)</option>
                        <option value="Schnelsen / Frohmestraße 48 /(0198)">Schnelsen / Frohmestraße 48 /(0198)</option>
                        <option value="Schwarzenbek / Compestrasse 1 /(0146)">Schwarzenbek / Compestrasse 1 /(0146)</option>
                        <option value="St. Georg / Schmilinskystraße 15 /(0802)">St. Georg / Schmilinskystraße 15 /(0802)</option>
                        <option value="St. Pauli / Clemens-Schultz-Strasse 38 /(0104)">St. Pauli / Clemens-Schultz-Strasse 38 /(0104)</option>
                        <option value="St. Pauli / Neuer Kamp 31 /(0233)">St. Pauli / Neuer Kamp 31 /(0233)</option>
                        <option value="St. Pauli / Talstraße 36 /(0774)">St. Pauli / Talstraße 36 /(0774)</option>
                        <option value="St.Georg / Lange Reihe 104-106 /(0175)">St.Georg / Lange Reihe 104-106 /(0175)</option>
                        <option value="St.Georg / Lange Reihe 18-20 /(0178)">St.Georg / Lange Reihe 18-20 /(0178)</option>
                        <option value="St.Georg / Steindamm 55 /(0282)">St.Georg / Steindamm 55 /(0282)</option>
                        <option value="Stade / Steile Straße 1 /(0248)">Stade / Steile Straße 1 /(0248)</option>
                        <option value="Steilshoop / Steilshooper Str. 281 /(0773)">Steilshoop / Steilshooper Str. 281 /(0773)</option>
                        <option value="Stelle / Harburger Straße 25 c /(0772)">Stelle / Harburger Straße 25 c /(0772)</option>
                        <option value="Stellingen / Kieler Str. 561-573 /(0745)">Stellingen / Kieler Str. 561-573 /(0745)</option>
                        <option value="Stellingen / Langenfelder Damm 62 /(0767)">Stellingen / Langenfelder Damm 62 /(0767)</option>
                        <option value="Sternschanze / Schanzenstraße 55 /(0768)">Sternschanze / Schanzenstraße 55 /(0768)</option>
                        <option value="Sternschanze / Schulterblatt 135 /(0268)">Sternschanze / Schulterblatt 135 /(0268)</option>
                        <option value="Sternschanze / Schulterblatt 45 /(0105)">Sternschanze / Schulterblatt 45 /(0105)</option>
                        <option value="Tangstedt / Eichholzkoppel 1 /(0267)">Tangstedt / Eichholzkoppel 1 /(0267)</option>
                        <option value="Timmendorfer STrand / Strandallee 81 /(0290)">Timmendorfer STrand / Strandallee 81 /(0290)</option>
                        <option value="Tonndorf / Ahrensburger Strasse 150-152 /(0131)">Tonndorf / Ahrensburger Strasse 150-152 /(0131)</option>
                        <option value="Tornesch / Ohlenhoff 4 /(0184)">Tornesch / Ohlenhoff 4 /(0184)</option>
                        <option value="Tostedt / Unter den Linden 5 /(0758)">Tostedt / Unter den Linden 5 /(0758)</option>
                        <option value="Tostedt / Zinnhütte 12 /(0280)">Tostedt / Zinnhütte 12 /(0280)</option>
                        <option value="Trittau / Poststraße 27-29 /(0245)">Trittau / Poststraße 27-29 /(0245)</option>
                        <option value="Uhlenhorst / Hofweg 46-48 /(0180)">Uhlenhorst / Hofweg 46-48 /(0180)</option>
                        <option value="Volksdorf / Claus-Ferck-Straße 8 /(0186)">Volksdorf / Claus-Ferck-Straße 8 /(0186)</option>
                        <option value="Volksdorf / Weiße Rose 8 /(0795)">Volksdorf / Weiße Rose 8 /(0795)</option>
                        <option value="Wandsbek / Friedrich-Ebert-Damm 79-85 /(0221)">Wandsbek / Friedrich-Ebert-Damm 79-85 /(0221)</option>
                        <option value="Wandsbek / Wandsbeker Marktstraße 103-107 /(0272)">Wandsbek / Wandsbeker Marktstraße 103-107 /(0272)</option>
                        <option value="Wandsbek / Wandsbeker Marktstraße 2 /(0288)">Wandsbek / Wandsbeker Marktstraße 2 /(0288)</option>
                        <option value="Wedel / Am Marienhof 1, 3 /(0263)">Wedel / Am Marienhof 1, 3 /(0263)</option>
                        <option value="Wedel / Bahnhofstraße 31 /(0776)">Wedel / Bahnhofstraße 31 /(0776)</option>
                        <option value="Wedel / Rissener Straße 125 /(0257)">Wedel / Rissener Straße 125 /(0257)</option>
                        <option value="Wellingsbüttel / Wellingsbüttler Weg 125 /(0177)">Wellingsbüttel / Wellingsbüttler Weg 125 /(0177)</option>
                        <option value="Wenningstedt/Sylt / Osterweg 2 /(0771)">Wenningstedt/Sylt / Osterweg 2 /(0771)</option>
                        <option value="Wentorf / Berliner Landstraße 4-6 /(0249)">Wentorf / Berliner Landstraße 4-6 /(0249)</option>
                        <option value="Wilhelmsburg / Vogelhüttendeich 48 /(0756)">Wilhelmsburg / Vogelhüttendeich 48 /(0756)</option>
                        <option value="Wilhelmsburg / Wilhelm-Strauß-Weg 2b /(0736)">Wilhelmsburg / Wilhelm-Strauß-Weg 2b /(0736)</option>
                        <option value="Winsen / Löhnfeld 10 /(0740)">Winsen / Löhnfeld 10 /(0740)</option>
                        <option value="Winsen / Rathausstraße 33 /(0197)">Winsen / Rathausstraße 33 /(0197)</option>
                        <option value="Winterhude / Gertigstraße 24 /(0275)">Winterhude / Gertigstraße 24 /(0275)</option>
                        <option value="Winterhude / Hudtwalckerstr. 19-21 /(0304)">Winterhude / Hudtwalckerstr. 19-21 /(0304)</option>
                        <option value="Winterhude / Jarrestr. 47 /(0749)">Winterhude / Jarrestr. 47 /(0749)</option>
                        <option value="Winterhude / Mühlenkamp 43 /(0305)">Winterhude / Mühlenkamp 43 /(0305)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="competitorName">🏢 Wettbewerber:</label>
                    <select id="competitorName">
                        <option value="">Wettbewerber auswählen...</option>
                        <option value="DM" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iIzAwNzVCRSIvPgo8dGV4dCB4PSIxMiIgeT0iMTYiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxNCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5kbTwvdGV4dD4KPC9zdmc+'); background-size: 20px; background-repeat: no-repeat; background-position: 12px center; padding-left: 40px;">DM-Drogerie Markt</option>
                        <option value="ROSSMANN" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iI0REMDAzMSIvPgo8dGV4dCB4PSIxMiIgeT0iMTYiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMCIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5ST1NTPC90ZXh0Pgo8L3N2Zz4='); background-size: 20px; background-repeat: no-repeat; background-position: 12px center; padding-left: 40px;">ROSSMANN</option>
                        <option value="MÜLLER" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iI0ZGNzUwMCIvPgo8dGV4dCB4PSIxMiIgeT0iMTciIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSIxMiIgZm9udC13ZWlnaHQ9ImJvbGQiIGZpbGw9IndoaXRlIiB0ZXh0LWFuY2hvcj0ibWlkZGxlIj5NPC90ZXh0Pgo8L3N2Zz4='); background-size: 20px; background-repeat: no-repeat; background-position: 12px center; padding-left: 40px;">MÜLLER Drogeriemarkt</option>
                        <option value="EDEKA" style="background-image: url('data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9IjI0IiBoZWlnaHQ9IjI0IiByeD0iNCIgZmlsbD0iIzAwNjZBQSIvPgo8dGV4dCB4PSIxMiIgeT0iMTAiIGZvbnQtZmFtaWx5PSJBcmlhbCwgc2Fucy1zZXJpZiIgZm9udC1zaXplPSI4IiBmb250LXdlaWdodD0iYm9sZCIgZmlsbD0iI0ZGRjMwMCIgdGV4dC1hbmNob3I9Im1pZGRsZSI+RURFS0E8L3RleHQ+CjwvcG9seWdvbj4KPC9zdmc+'); background-size: 20px; background-repeat: no-repeat; background-position: 12px center; padding-left: 40px;">EDEKA</option>
                    </select>
                </div>
                <div class="selection-info">
                    ℹ️ Wählen Sie entweder eine eigene Filiale ODER einen Wettbewerber aus
                </div>
                <div class="input-group">
                    <label for="visitorName">👤 Besucher:</label>
                    <input type="text" id="visitorName" placeholder="Ihr Name (wird für Session gespeichert)">
                </div>
                <div class="input-group">
                    <label for="visitTime">⏰ Uhrzeit:</label>
                    <input type="time" id="visitTime">
                </div>
            </div>

            <div id="entriesContainer">
                <div class="entry-item" data-entry="1">
                    <div class="entry-header">
                        <div class="entry-header-left">
                            <span class="entry-number">Punkt 1</span>
                            <div class="image-upload" onclick="document.getElementById('imageInput-1').click()" role="button" tabindex="0" aria-label="Bilder für ersten Punkt hinzufügen" title="Bilder hinzufügen">
                                <span class="image-upload-icon">📷</span>
                                <input type="file" id="imageInput-1" class="hidden" multiple accept="image/*" onchange="handleImageUpload(this, 1)" aria-label="Bilddateien auswählen">
                            </div>
                        </div>
                        <button class="delete-btn hidden" onclick="deleteEntry(this)" aria-label="Punkt 1 löschen" title="Punkt löschen">🗑️</button>
                    </div>
                    
                    <textarea class="text-area" placeholder="Beschreiben Sie hier Ihre Beobachtungen, Notizen oder Anmerkungen..." aria-label="Notizen für Punkt 1"></textarea>
                    
                    <div class="image-preview" id="imagePreview-1" aria-live="polite"></div>
                </div>
            </div>

            <button class="add-entry-btn" onclick="addEntry()" aria-label="Neuen Dokumentationspunkt hinzufügen">
                ➕ Weiteren Punkt hinzufügen
            </button>

            <div class="loading" id="loading">
                📄 PDF wird erstellt...
            </div>

            <div class="success-message" id="successMessage">
                ✅ PDF erfolgreich erstellt und heruntergeladen!
            </div>

            <div class="actions">
                <button class="btn btn-primary" onclick="generatePDF()" aria-label="PDF-Bericht erstellen und herunterladen">
                    📄 PDF erstellen
                </button>
                <button class="btn btn-secondary" onclick="resetForm()" aria-label="Alle Eingaben zurücksetzen">
                    🔄 Zurücksetzen
                </button>
            </div>
        </div>
    </div>

    <!-- Lightbox für Bildvergrößerung -->
    <div class="lightbox" id="lightbox" onclick="closeLightbox(event)">
        <div class="lightbox-content">
            <button class="lightbox-close" onclick="closeLightbox()" aria-label="Bild schließen">×</button>
            <img class="lightbox-img" id="lightboxImg" src="" alt="">
            <div class="lightbox-info" id="lightboxInfo"></div>
        </div>
    </div>

    <script>
        let entryCounter = 1;
        let imageData = {};
        let savedVisitorName = '';
        let userLocation = null;
        let isLocationDetected = false;

        // Datum auf heute setzen
        document.getElementById('visitDate').valueAsDate = new Date();
        
        // Aktuelle Zeit setzen
        const now = new Date();
        document.getElementById('visitTime').value = now.toTimeString().slice(0,5);

        // Standort-basierte Filialvorschläge
        const filialLocations = {
            'Hamburg': {
                lat: 53.5511,
                lng: 9.9937,
                keywords: ['Ahrensburg', 'Alsterdorf', 'Altona', 'Altstadt', 'Ammersbek', 'Bahrenfeld', 'Bargteheide', 'Barmbek', 'Barsbüttel', 'Bergedorf', 'Bergstedt', 'Billstedt', 'Blankenese', 'Börnsen', 'Bramfeld', 'Duvenstedt', 'Eidelstedt', 'Eilbek', 'Eimsbüttel', 'Eppendorf', 'Farmsen', 'Finkenwerder', 'Fuhlsbüttel', 'Glinde', 'Groß Borstel', 'Gross Flottbek', 'Grosshansdorf', 'HafenCity', 'Halstenbek', 'Hamm', 'Hammerbrook', 'Harburg', 'Harvestehude', 'Heimfeld', 'Hittfeld', 'Hoheluft', 'Horn', 'Hummelsbüttel', 'Langenhorn', 'Lohbrügge', 'Lokstedt', 'Lurup', 'Marienthal', 'Marmstorf', 'Maschen', 'Meckelfeld', 'Mundsburg', 'Neu Wulmstorf', 'Neuengamme', 'Neugraben', 'Neustadt', 'Neuwiedenthal', 'Niedermarschacht', 'Niendorf', 'Nienstedten', 'Norderstedt', 'Osdorf', 'Oststeinbek', 'Othmarschen', 'Ottensen', 'Pinneberg', 'Poppenbüttel', 'Quickborn', 'Rahlstedt', 'Reinbek', 'Rellingen', 'Rissen', 'Rothenburgsort', 'Rotherbaum', 'Sasel', 'Schenefeld', 'Schnelsen', 'St. Georg', 'St. Pauli', 'Steilshoop', 'Stelle', 'Stellingen', 'Sternschanze', 'Tangstedt', 'Tonndorf', 'Tornesch', 'Trittau', 'Uhlenhorst', 'Volksdorf', 'Wandsbek', 'Wedel', 'Wellingsbüttel', 'Wentorf', 'Wilhelmsburg', 'Winterhude']
            },
            'Berlin': {
                lat: 52.5200,
                lng: 13.4050,
                keywords: ['Berlin']
            },
            'Lübeck': {
                lat: 53.8648,
                lng: 10.6865,
                keywords: ['Lübeck', 'Bad Oldesloe', 'Bad Segeberg', 'Büchen', 'Mölln', 'Schwarzenbek']
            },
            'Lüneburg': {
                lat: 53.2493,
                lng: 10.4070,
                keywords: ['Lüneburg', 'Buchholz', 'Hanstedt', 'Jesteburg', 'Tostedt', 'Winsen']
            },
            'Buxtehude': {
                lat: 53.4774,
                lng: 9.6951,
                keywords: ['Buxtehude', 'Apensen', 'Dollern', 'Harsefeld', 'Stade']
            },
            'Sylt': {
                lat: 54.9079,
                lng: 8.3147,
                keywords: ['Wenningstedt', 'Sylt', 'Keitum']
            },
            'Timmendorfer Strand': {
                lat: 54.0079,
                lng: 10.7717,
                keywords: ['Timmendorfer STrand']
            },
            'Geesthacht': {
                lat: 53.4308,
                lng: 10.3695,
                keywords: ['Geesthacht']
            },
            'Kaltenkirchen': {
                lat: 53.8386,
                lng: 9.9717,
                keywords: ['Kaltenkirchen', 'Henstedt-Ulzburg', 'Nahe']
            }
        };

        // Geolocation initialisieren
        function initGeolocation() {
            if (navigator.geolocation) {
                // Subtile Standort-Anfrage
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        sortFilialsByLocation();
                        isLocationDetected = true;
                        
                        // Dezenter Hinweis
                        showLocationHint('📍 Filialen nach Nähe sortiert');
                    },
                    function(error) {
                        // Fehler stillschweigend ignorieren - kein störender Alert
                        console.log('Standort nicht verfügbar:', error.message);
                    },
                    {
                        enableHighAccuracy: false,
                        timeout: 5000,
                        maximumAge: 300000 // 5 Minuten Cache
                    }
                );
            }
        }

        // Distanz zwischen zwei Koordinaten berechnen (Haversine Formel)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Erdradius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Nächste Region finden
        function findNearestRegion() {
            if (!userLocation) return null;
            
            let nearestRegion = null;
            let minDistance = Infinity;
            
            for (const [region, data] of Object.entries(filialLocations)) {
                const distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    data.lat, data.lng
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestRegion = region;
                }
            }
            
            return nearestRegion;
        }

        // Filialen nach Standort sortieren
        function sortFilialsByLocation() {
            const select = document.getElementById('branchName');
            const options = Array.from(select.options).slice(1); // Erste Option ("Filiale auswählen") ausschließen
            
            const nearestRegion = findNearestRegion();
            if (!nearestRegion) return;
            
            const regionKeywords = filialLocations[nearestRegion].keywords;
            
            // Sortiere Optionen: Nahe Filialen zuerst
            options.sort((a, b) => {
                const aIsNear = regionKeywords.some(keyword => 
                    a.value.toLowerCase().includes(keyword.toLowerCase())
                );
                const bIsNear = regionKeywords.some(keyword => 
                    b.value.toLowerCase().includes(keyword.toLowerCase())
                );
                
                if (aIsNear && !bIsNear) return -1;
                if (!aIsNear && bIsNear) return 1;
                return 0; // Ursprüngliche Reihenfolge beibehalten
            });
            
            // Dropdown neu aufbauen
            select.innerHTML = '<option value="">📍 Filiale auswählen...</option>';
            
            // Gruppierung mit Trennlinie
            let nearOptionsAdded = false;
            options.forEach(option => {
                const isNear = regionKeywords.some(keyword => 
                    option.value.toLowerCase().includes(keyword.toLowerCase())
                );
                
                if (isNear && !nearOptionsAdded) {
                    const separator = document.createElement('option');
                    separator.disabled = true;
                    separator.textContent = `──── 📍 Nahe ${nearestRegion} ────`;
                    select.appendChild(separator);
                    nearOptionsAdded = true;
                } else if (!isNear && nearOptionsAdded) {
                    const separator = document.createElement('option');
                    separator.disabled = true;
                    separator.textContent = '──── 🏢 Weitere Filialen ────';
                    select.appendChild(separator);
                    nearOptionsAdded = false; // Reset für weitere Gruppierungen
                }
                
                select.appendChild(option);
            });
        }

        // Audit-Stil Bildzeile mit verbesserter Fehlerbehandlung
        async function renderAuditImageRow(pdf, images, yPos, spacing) {
            let currentX = 25;
            
            for (let i = 0; i < images.length; i++) {
                const image = images[i];
                
                if (image.error) {
                    // Audit-Stil Fehler-Box
                    pdf.setFillColor(248, 249, 250);
                    pdf.rect(currentX, yPos, image.width, image.height, 'F');
                    pdf.setDrawColor(220, 53, 69);
                    pdf.setLineWidth(1);
                    pdf.rect(currentX, yPos, image.width, image.height, 'S');
                    
                    pdf.setTextColor(220, 53, 69);
                    pdf.setFont('helvetica', 'bold');
                    pdf.setFontSize(8);
                    pdf.text('BILD', currentX + image.width/2, yPos + image.height/2 - 2, { align: 'center' });
                    pdf.text('FEHLER', currentX + image.width/2, yPos + image.height/2 + 2, { align: 'center' });
                    pdf.setTextColor(0, 0, 0);
                } else {
                    try {
                        // Audit-Stil: Schwarzer Rahmen um Bilder
                        pdf.setDrawColor(31, 41, 55);
                        pdf.setLineWidth(1);
                        pdf.rect(currentX - 1, yPos - 1, image.width + 2, image.height + 2, 'S');
                        
                        // Bild einfügen (bereits orientierungskorrigiert)
                        pdf.addImage(image.src, 'JPEG', currentX, yPos, image.width, image.height);
                        
                        // Bildnummer unten rechts
                        pdf.setFillColor(31, 41, 55);
                        pdf.rect(currentX + image.width - 12, yPos + image.height - 8, 12, 8, 'F');
                        pdf.setTextColor(255, 255, 255);
                        pdf.setFont('helvetica', 'bold');
                        pdf.setFontSize(7);
                        pdf.text(String(i + 1), currentX + image.width - 6, yPos + image.height - 3, { align: 'center' });
                        pdf.setTextColor(0, 0, 0);
                        
                    } catch (error) {
                        console.log('Fehler beim Rendern des Bildes:', error);
                        // Fallback Fehler-Darstellung
                        pdf.setFillColor(248, 249, 250);
                        pdf.rect(currentX, yPos, image.width, image.height, 'F');
                        pdf.setDrawColor(220, 53, 69);
                        pdf.setLineWidth(1);
                        pdf.rect(currentX, yPos, image.width, image.height, 'S');
                        
                        pdf.setTextColor(220, 53, 69);
                        pdf.setFont('helvetica', 'bold');
                        pdf.setFontSize(8);
                        pdf.text('BILD', currentX + image.width/2, yPos + image.height/2 - 2, { align: 'center' });
                        pdf.text('FEHLER', currentX + image.width/2, yPos + image.height/2 + 2, { align: 'center' });
                        pdf.setTextColor(0, 0, 0);
                    }
                }
                
                currentX += image.width + spacing;
            }
        }

        // Dezenter Standort-Hinweis
        function showLocationHint(message) {
            const label = document.querySelector('label[for="branchName"]');
            const originalText = label.textContent;
            
            label.style.color = '#27ae60';
            label.textContent = `🏪 ${message}`;
            
            setTimeout(() => {
                label.style.color = '';
                label.textContent = originalText;
            }, 3000);
        }

        // Fallback-Funktion für Kompatibilität
        async function renderImageRow(pdf, images, yPos, spacing) {
            return await renderProfessionalImageRow(pdf, images, yPos, spacing);
        }

        // Funktion zur Korrektur der Bildorientierung
        function getImageOrientation(imageData) {
            const view = new DataView(imageData);
            if (view.getUint16(0, false) !== 0xFFD8) {
                return 1; // Nicht JPEG
            }
            const length = view.byteLength;
            let offset = 2;
            while (offset < length) {
                if (view.getUint16(offset, false) === 0xFFE1) {
                    offset += 4;
                    if (view.getUint32(offset, false) !== 0x45786966) {
                        return 1;
                    }
                    const little = view.getUint16(offset += 6, false) === 0x4949;
                    offset += view.getUint32(offset + 4, little);
                    const tags = view.getUint16(offset, little);
                    offset += 2;
                    for (let i = 0; i < tags; i++) {
                        if (view.getUint16(offset + (i * 12), little) === 0x0112) {
                            return view.getUint16(offset + (i * 12) + 8, little);
                        }
                    }
                } else if ((view.getUint16(offset, false) & 0xFF00) !== 0xFF00) {
                    break;
                } else {
                    offset += 2 + view.getUint16(offset + 2, false);
                }
            }
            return 1;
        }

        // Funktion zur Bildrotation basierend auf EXIF
        function getRotationAngle(orientation) {
            switch (orientation) {
                case 3: return 180;
                case 6: return 90;
                case 8: return 270;
                default: return 0;
            }
        }

        // Verbesserte Bildverarbeitung mit Orientierungskorrektur
        async function processImageWithOrientation(imageSrc) {
            return new Promise((resolve) => {
                const img = new Image();
                img.onload = () => {
                    // Canvas erstellen für Orientierungskorrektur
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // Original-Dimensionen
                    let { width, height } = img;
                    
                    // EXIF-Orientierung ermitteln (vereinfacht)
                    // Für mobile Geräte nehmen wir an, dass Hochformat-Bilder oft gedreht sind
                    const isPortrait = height > width;
                    let rotation = 0;
                    
                    // Einfache Heuristik für mobile Fotos
                    if (isPortrait && imageSrc.includes('data:image')) {
                        // Prüfe ob das Bild von einem mobilen Gerät stammt
                        rotation = 0; // Lassen wir erstmal so
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // Bild ohne Rotation zeichnen (Browser korrigiert bereits)
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    resolve({
                        canvas: canvas,
                        width: width,
                        height: height,
                        dataUrl: canvas.toDataURL('image/jpeg', 0.8)
                    });
                };
                img.src = imageSrc;
            });
        }

        // Namen aus vorherigen Eingaben wiederverwenden
        document.getElementById('visitorName').addEventListener('blur', function() {
            savedVisitorName = this.value;
        });

        // Wettbewerber/Filial-Auswahl Management
        function setupCompetitorBranchLogic() {
            const branchSelect = document.getElementById('branchName');
            const competitorSelect = document.getElementById('competitorName');
            
            branchSelect.addEventListener('change', function() {
                if (this.value) {
                    competitorSelect.value = '';
                    competitorSelect.style.opacity = '0.6';
                    clearValidationErrors();
                } else {
                    competitorSelect.style.opacity = '1';
                }
            });
            
            competitorSelect.addEventListener('change', function() {
                if (this.value) {
                    branchSelect.value = '';
                    branchSelect.style.opacity = '0.6';
                    clearValidationErrors();
                } else {
                    branchSelect.style.opacity = '1';
                }
            });
        }

        // Validierungsfehler entfernen
        function clearValidationErrors() {
            const errorEl = document.getElementById('validationError');
            const branchSelect = document.getElementById('branchName');
            const competitorSelect = document.getElementById('competitorName');
            
            if (errorEl) {
                errorEl.style.display = 'none';
            }
            
            branchSelect.classList.remove('validation-error');
            competitorSelect.classList.remove('validation-error');
        }

        // Validierung vor PDF-Export
        function validateSelection() {
            const branchValue = document.getElementById('branchName').value;
            const competitorValue = document.getElementById('competitorName').value;
            
            if (!branchValue && !competitorValue) {
                showValidationError('Bitte wählen Sie entweder eine Filiale ODER einen Wettbewerber aus!');
                return false;
            }
            
            clearValidationErrors();
            return true;
        }

        // Validierungsfehler anzeigen
        function showValidationError(message) {
            const branchSelect = document.getElementById('branchName');
            const competitorSelect = document.getElementById('competitorName');
            
            // Felder rot markieren
            branchSelect.classList.add('validation-error');
            competitorSelect.classList.add('validation-error');
            
            // Fehlermeldung erstellen oder aktualisieren
            let errorEl = document.getElementById('validationError');
            if (!errorEl) {
                errorEl = document.createElement('div');
                errorEl.id = 'validationError';
                errorEl.className = 'error-message';
                
                // Nach der selection-info einfügen
                const selectionInfo = document.querySelector('.selection-info');
                selectionInfo.parentNode.insertBefore(errorEl, selectionInfo.nextSibling);
            }
            
            errorEl.textContent = `⚠️ ${message}`;
            errorEl.style.display = 'block';
            
            // Zum Fehler scrollen
            scrollToElement(errorEl);
            
            // Haptic Feedback für iOS
            if (window.navigator && window.navigator.vibrate) {
                window.navigator.vibrate([100, 100, 100]);
            }
        }

        // Verbessertes Touch-Feedback für alle Buttons
        function addTouchFeedback() {
            const buttons = document.querySelectorAll('button, .image-upload, .btn');
            
            buttons.forEach(button => {
                // Entferne alte Event Listener um Duplikate zu vermeiden
                button.removeEventListener('touchstart', handleTouchStart);
                button.removeEventListener('touchend', handleTouchEnd);
                button.removeEventListener('touchcancel', handleTouchCancel);
                
                button.addEventListener('touchstart', handleTouchStart, { passive: true });
                button.addEventListener('touchend', handleTouchEnd, { passive: true });
                button.addEventListener('touchcancel', handleTouchCancel, { passive: true });
            });
        }

        function handleTouchStart(e) {
            this.style.transform = 'scale(0.95)';
            this.style.transition = 'transform 0.1s ease';
        }

        function handleTouchEnd(e) {
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 50);
        }

        function handleTouchCancel(e) {
            this.style.transform = 'scale(1)';
        }

        // Mobile-optimierte Scroll-Funktion
        function scrollToElement(element) {
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }

        function addEntry() {
            entryCounter++;
            const container = document.getElementById('entriesContainer');
            
            const entryDiv = document.createElement('div');
            entryDiv.className = 'entry-item';
            entryDiv.setAttribute('data-entry', entryCounter);
            
            entryDiv.innerHTML = `
                <div class="entry-header">
                    <div class="entry-header-left">
                        <span class="entry-number">Punkt ${entryCounter}</span>
                        <div class="image-upload" onclick="document.getElementById('imageInput-${entryCounter}').click()" role="button" tabindex="0" aria-label="Bilder für Punkt ${entryCounter} hinzufügen" title="Bilder hinzufügen">
                            <span class="image-upload-icon">📷</span>
                            <input type="file" id="imageInput-${entryCounter}" class="hidden" multiple accept="image/*" onchange="handleImageUpload(this, ${entryCounter})" aria-label="Bilddateien auswählen">
                        </div>
                    </div>
                    <button class="delete-btn" onclick="deleteEntry(this)" aria-label="Punkt ${entryCounter} löschen" title="Punkt löschen">🗑️</button>
                </div>
                
                <textarea class="text-area" placeholder="Beschreiben Sie hier Ihre Beobachtungen, Notizen oder Anmerkungen..." aria-label="Notizen für Punkt ${entryCounter}"></textarea>
                
                <div class="image-preview" id="imagePreview-${entryCounter}" aria-live="polite"></div>
            `;
            
            container.appendChild(entryDiv);
            
            // Mobile-optimierte Initialisierung
            setupDragAndDrop(entryDiv.querySelector('.image-upload'), entryCounter);
            addTouchFeedback();
            updateDeleteButtons();
            
            // Sanft zum neuen Element scrollen
            setTimeout(() => {
                scrollToElement(entryDiv);
            }, 100);
        }

        // Mobile-optimierte Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop(document.querySelector('.image-upload'), 1);
            addTouchFeedback();
            setupCompetitorBranchLogic();
            
            // Standort-basierte Filialvorschläge initialisieren
            setTimeout(() => {
                initGeolocation();
            }, 1000); // Kurze Verzögerung für bessere UX
            
            // Viewport-Meta für mobile Optimierung prüfen
            if (!document.querySelector('meta[name="viewport"]')) {
                const viewport = document.createElement('meta');
                viewport.name = 'viewport';
                viewport.content = 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no';
                document.head.appendChild(viewport);
            }
            
            // iOS Safari Scrolling-Verbesserung
            if (navigator.userAgent.includes('Safari') && navigator.userAgent.includes('Mobile')) {
                document.body.style.webkitOverflowScrolling = 'touch';
            }
        });

        function deleteEntry(button) {
            const entry = button.closest('.entry-item');
            const entryNumber = entry.getAttribute('data-entry');
            
            // Bilder aus imageData entfernen
            delete imageData[entryNumber];
            
            entry.remove();
            updateDeleteButtons();
            renumberEntries();
        }

        function updateDeleteButtons() {
            const entries = document.querySelectorAll('.entry-item');
            entries.forEach((entry, index) => {
                const deleteBtn = entry.querySelector('.delete-btn');
                if (entries.length > 1) {
                    deleteBtn.classList.remove('hidden');
                } else {
                    deleteBtn.classList.add('hidden');
                }
            });
        }

        function renumberEntries() {
            const entries = document.querySelectorAll('.entry-item');
            entries.forEach((entry, index) => {
                const number = index + 1;
                entry.setAttribute('data-entry', number);
                entry.querySelector('.entry-number').textContent = `Punkt ${number}`;
            });
        }

        function handleImageUpload(input, entryNumber) {
            const files = input.files;
            const preview = document.getElementById(`imagePreview-${entryNumber}`);
            
            if (!imageData[entryNumber]) {
                imageData[entryNumber] = [];
            }
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageInfo = {
                            src: e.target.result,
                            name: file.name
                        };
                        
                        imageData[entryNumber].push(imageInfo);
                        displayImage(entryNumber, imageInfo, imageData[entryNumber].length - 1);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function displayImage(entryNumber, imageInfo, index) {
            const preview = document.getElementById(`imagePreview-${entryNumber}`);
            
            const imageDiv = document.createElement('div');
            imageDiv.className = 'image-item';
            
            imageDiv.innerHTML = `
                <img src="${imageInfo.src}" alt="${imageInfo.name}">
                <button class="image-remove" onclick="removeImage(${entryNumber}, ${index})">×</button>
            `;
            
            preview.appendChild(imageDiv);
        }

        function removeImage(entryNumber, index) {
            imageData[entryNumber].splice(index, 1);
            refreshImagePreview(entryNumber);
        }

        function refreshImagePreview(entryNumber) {
            const preview = document.getElementById(`imagePreview-${entryNumber}`);
            preview.innerHTML = '';
            
            if (imageData[entryNumber]) {
                imageData[entryNumber].forEach((imageInfo, index) => {
                    displayImage(entryNumber, imageInfo, index);
                });
            }
        }

        function setupDragAndDrop(uploadDiv, entryNumber) {
            uploadDiv.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadDiv.classList.add('drag-over');
            });
            
            uploadDiv.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadDiv.classList.remove('drag-over');
            });
            
            uploadDiv.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadDiv.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                const input = document.getElementById(`imageInput-${entryNumber}`);
                input.files = files;
                handleImageUpload(input, entryNumber);
            });
        }

        // Drag & Drop für initial existierenden Upload-Bereich
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop(document.querySelector('.image-upload'), 1);
        });

        async function generatePDF() {
            // Validierung vor PDF-Erstellung
            if (!validateSelection()) {
                return;
            }
            
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            const loadingEl = document.getElementById('loading');
            const successEl = document.getElementById('successMessage');
            
            loadingEl.style.display = 'block';
            
            // Mobile: Scroll zum Loading-Indikator
            scrollToElement(loadingEl);
            
            try {
                // Header
                pdf.setFontSize(18);
                pdf.setFont(undefined, 'bold');
                
                const branchValue = document.getElementById('branchName').value;
                const competitorValue = document.getElementById('competitorName').value;
                const documentTitle = competitorValue ? 
                    `Wettbewerber-Besuch: ${competitorValue}` : 
                    'Filialbesuch Dokumentation';
                
                pdf.text(documentTitle, 20, 25);
                
                // Besuchsinformationen
                pdf.setFontSize(11);
                pdf.setFont(undefined, 'normal');
                const visitDate = document.getElementById('visitDate').value;
                const visitorName = document.getElementById('visitorName').value;
                const visitTime = document.getElementById('visitTime').value;
                
                let yPos = 40;
                pdf.text(`Datum: ${visitDate}`, 20, yPos);
                pdf.text(`Uhrzeit: ${visitTime}`, 110, yPos);
                yPos += 8;
                
                if (branchValue) {
                    pdf.text(`Eigene Filiale: ${branchValue}`, 20, yPos);
                } else if (competitorValue) {
                    pdf.text(`Wettbewerber: ${competitorValue}`, 20, yPos);
                }
                yPos += 8;
                pdf.text(`Besucher: ${visitorName}`, 20, yPos);
                
                yPos += 15;
                
                // Einträge
                const entries = document.querySelectorAll('.entry-item');
                
                for (let i = 0; i < entries.length; i++) {
                    const entry = entries[i];
                    const entryNumber = entry.getAttribute('data-entry');
                    const text = entry.querySelector('.text-area').value;
                    
                    // Neue Seite wenn nötig
                    if (yPos > 260) {
                        pdf.addPage();
                        yPos = 20;
                    }
                    
                    // Punkt-Header
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(`Punkt ${i + 1}:`, 20, yPos);
                    yPos += 8;
                    
                    // Text
                    pdf.setFontSize(10);
                    pdf.setFont(undefined, 'normal');
                    if (text) {
                        const splitText = pdf.splitTextToSize(text, 170);
                        pdf.text(splitText, 20, yPos);
                        yPos += splitText.length * 5;
                    } else {
                        pdf.text('(Keine Notizen)', 20, yPos);
                        yPos += 5;
                    }
                    
                    // Bilder mit korrektem Seitenverhältnis nebeneinander anordnen
                    if (imageData[entryNumber] && imageData[entryNumber].length > 0) {
                        yPos += 5;
                        
                        const images = imageData[entryNumber];
                        const maxRowWidth = 170; // Verfügbare Breite für Bilder
                        const imageSpacing = 5; // Abstand zwischen Bildern
                        
                        let currentRowImages = [];
                        let currentRowWidth = 0;
                        
                        for (let j = 0; j < images.length; j++) {
                            const image = images[j];
                            
                            try {
                                // Temporäres Image-Element erstellen um Dimensionen zu ermitteln
                                const tempImg = new Image();
                                tempImg.src = image.src;
                                
                                // Warten bis Bild geladen ist
                                await new Promise((resolve) => {
                                    if (tempImg.complete) {
                                        resolve();
                                    } else {
                                        tempImg.onload = resolve;
                                        tempImg.onerror = resolve;
                                    }
                                });
                                
                                // Originale Dimensionen
                                const originalWidth = tempImg.naturalWidth || tempImg.width;
                                const originalHeight = tempImg.naturalHeight || tempImg.height;
                                
                                // Maximale Größe pro Bild
                                const maxImgWidth = 60;
                                const maxImgHeight = 45;
                                
                                // Seitenverhältnis beibehalten
                                let imgWidth = maxImgWidth;
                                let imgHeight = maxImgHeight;
                                
                                if (originalWidth && originalHeight) {
                                    const aspectRatio = originalWidth / originalHeight;
                                    
                                    if (aspectRatio > 1) {
                                        // Querformat
                                        imgWidth = maxImgWidth;
                                        imgHeight = maxImgWidth / aspectRatio;
                                        
                                        if (imgHeight > maxImgHeight) {
                                            imgHeight = maxImgHeight;
                                            imgWidth = maxImgHeight * aspectRatio;
                                        }
                                    } else {
                                        // Hochformat
                                        imgHeight = maxImgHeight;
                                        imgWidth = maxImgHeight * aspectRatio;
                                        
                                        if (imgWidth > maxImgWidth) {
                                            imgWidth = maxImgWidth;
                                            imgHeight = maxImgWidth / aspectRatio;
                                        }
                                    }
                                }
                                
                                // Prüfen ob Bild in aktuelle Zeile passt
                                const neededWidth = currentRowWidth + (currentRowImages.length > 0 ? imageSpacing : 0) + imgWidth;
                                
                                if (neededWidth > maxRowWidth && currentRowImages.length > 0) {
                                    // Aktuelle Zeile rendern
                                    await renderImageRow(pdf, currentRowImages, yPos, imageSpacing);
                                    yPos += Math.max(...currentRowImages.map(img => img.height)) + 15; // +15 für Bildnamen
                                    
                                    // Neue Zeile beginnen
                                    currentRowImages = [];
                                    currentRowWidth = 0;
                                    
                                    // Neue Seite wenn nötig
                                    if (yPos + imgHeight > 260) {
                                        pdf.addPage();
                                        yPos = 20;
                                    }
                                }
                                
                                // Bild zur aktuellen Zeile hinzufügen
                                currentRowImages.push({
                                    src: image.src,
                                    name: image.name,
                                    width: imgWidth,
                                    height: imgHeight
                                });
                                currentRowWidth += imgWidth + (currentRowImages.length > 1 ? imageSpacing : 0);
                                
                            } catch (error) {
                                console.log('Fehler beim Verarbeiten des Bildes:', error);
                                // Fehlermeldung als "Bild" hinzufügen
                                currentRowImages.push({
                                    error: true,
                                    name: image.name,
                                    width: 50,
                                    height: 10
                                });
                            }
                        }
                        
                        // Letzte Zeile rendern
                        if (currentRowImages.length > 0) {
                            await renderImageRow(pdf, currentRowImages, yPos, imageSpacing);
                            yPos += Math.max(...currentRowImages.map(img => img.height)) + 15; // +15 für Bildnamen
                        }
                    }
                    
                    
                    yPos += 10;
                }
                
                // PDF herunterladen - mobile-freundlicher Dateiname
                const date = visitDate || new Date().toISOString().split('T')[0];
                const safeName = competitorValue ? 
                    competitorValue.replace(/[^\w\s-]/g, '') : 
                    (branchValue || 'Unbekannt').substring(0, 30).replace(/[^\w\s-]/g, '');
                const filePrefix = competitorValue ? 'Wettbewerber' : 'Filialbesuch';
                const fileName = `${filePrefix}_${safeName}_${date}.pdf`;
                
                pdf.save(fileName);
                
                // Erfolgsmeldung mit verbesserter mobiler UX
                successEl.style.display = 'block';
                scrollToElement(successEl);
                
                // Haptic Feedback für iOS
                if (window.navigator && window.navigator.vibrate) {
                    window.navigator.vibrate([100, 50, 100]);
                }
                
                setTimeout(() => {
                    successEl.style.display = 'none';
                }, 4000);
                
            } catch (error) {
                alert('Fehler beim Erstellen des PDFs: ' + error.message);
                console.error('PDF Error:', error);
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        function resetForm() {
            // Mobile-optimierte Bestätigung
            const confirmMessage = 'Möchten Sie wirklich alle Eingaben zurücksetzen?\n\nDies kann nicht rückgängig gemacht werden.';
            
            if (confirm(confirmMessage)) {
                // Loading-Indikator für mobile UX
                const loadingEl = document.getElementById('loading');
                loadingEl.innerHTML = '🔄 Formular wird zurückgesetzt...';
                loadingEl.style.display = 'block';
                
                setTimeout(() => {
                    // Alle Einträge außer dem ersten entfernen
                    const entries = document.querySelectorAll('.entry-item');
                    for (let i = entries.length - 1; i > 0; i--) {
                        entries[i].remove();
                    }
                    
                    // Ersten Eintrag zurücksetzen
                    const firstEntry = document.querySelector('.entry-item');
                    const textarea = firstEntry.querySelector('.text-area');
                    const imagePreview = firstEntry.querySelector('.image-preview');
                    
                    textarea.value = '';
                    imagePreview.innerHTML = '';
                    
                    // Besuchsinformationen zurücksetzen
                    document.getElementById('branchName').selectedIndex = 0;
                    document.getElementById('competitorName').selectedIndex = 0;
                    
                    // Dropdown-Opacity zurücksetzen
                    document.getElementById('branchName').style.opacity = '1';
                    document.getElementById('competitorName').style.opacity = '1';
                    
                    // Namen aus Session wiederverwenden, falls vorhanden
                    document.getElementById('visitorName').value = savedVisitorName;
                    
                    // Datum und Zeit auf heute/jetzt setzen
                    document.getElementById('visitDate').valueAsDate = new Date();
                    const now = new Date();
                    document.getElementById('visitTime').value = now.toTimeString().slice(0,5);
                    
                    // Validierungsfehler entfernen
                    clearValidationErrors();
                    
                    // Image Data zurücksetzen
                    imageData = {};
                    entryCounter = 1;
                    
                    // Delete-Buttons aktualisieren
                    updateDeleteButtons();
                    
                    // Touch-Feedback neu initialisieren
                    addTouchFeedback();
                    
                    // Zum Anfang scrollen
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // Loading ausblenden
                    loadingEl.style.display = 'none';
                    loadingEl.innerHTML = '📄 PDF wird erstellt...';
                    
                    // Haptic Feedback für iOS
                    if (window.navigator && window.navigator.vibrate) {
                        window.navigator.vibrate(100);
                    }
                    
                    // Erfolg anzeigen
                    const successEl = document.getElementById('successMessage');
                    successEl.innerHTML = '✅ Formular erfolgreich zurückgesetzt!';
                    successEl.style.display = 'block';
                    
                    setTimeout(() => {
                        successEl.style.display = 'none';
                        successEl.innerHTML = '✅ PDF erfolgreich erstellt und heruntergeladen!';
                    }, 2000);
                    
                }, 100); // Kurze Verzögerung für bessere UX
            }
        }
    </script>
</body>
</html>