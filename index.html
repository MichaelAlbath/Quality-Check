<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filialbesuch Dokumentation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            -webkit-overflow-scrolling: touch;
            -webkit-text-size-adjust: 100%;
        }

        .container {
            max-width: 100%;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.15);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(45deg, #2c3e50, #34495e);
            color: white;
            padding: 25px 20px;
            text-align: center;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.9;
            font-size: 1rem;
            line-height: 1.4;
        }

        .content {
            padding: 20px;
        }

        .visit-info {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 25px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 15px;
            border-left: 4px solid #667eea;
        }

        .input-group {
            display: flex;
            flex-direction: column;
        }

        .input-group label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .input-group input,
        .input-group select {
            padding: 16px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-size: 16px;
            transition: all 0.3s ease;
            background: white;
            appearance: none;
            -webkit-appearance: none;
            min-height: 54px;
        }

        .input-group input:focus,
        .input-group select:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
            transform: scale(1.02);
        }

        .input-group select {
            cursor: pointer;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='currentColor' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6,9 12,15 18,9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 15px center;
            background-size: 20px;
            padding-right: 50px;
        }

        .entry-item {
            background: #fff;
            border: 2px solid #e1e8ed;
            border-radius: 15px;
            padding: 20px;
            margin-bottom: 20px;
            position: relative;
            transition: all 0.3s ease;
        }

        .entry-item:hover {
            border-color: #667eea;
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.15);
        }

        .entry-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .entry-number {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            padding: 12px 20px;
            border-radius: 25px;
            font-weight: 600;
            font-size: 1rem;
            flex-shrink: 0;
        }

        .delete-btn {
            background: #e74c3c;
            color: white;
            border: none;
            padding: 12px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            min-height: 44px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .delete-btn:hover,
        .delete-btn:active {
            background: #c0392b;
            transform: scale(0.98);
        }

        .text-area {
            width: 100%;
            min-height: 140px;
            padding: 18px;
            border: 2px solid #e1e8ed;
            border-radius: 12px;
            font-family: inherit;
            font-size: 16px;
            resize: vertical;
            transition: all 0.3s ease;
            margin-bottom: 20px;
            line-height: 1.5;
        }

        .text-area:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 4px rgba(102, 126, 234, 0.15);
        }

        .image-upload {
            border: 3px dashed #bdc3c7;
            border-radius: 15px;
            padding: 30px 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #f8f9fa;
            min-height: 120px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            gap: 8px;
        }

        .image-upload:hover,
        .image-upload:active {
            border-color: #667eea;
            background: #f0f4ff;
            transform: scale(1.02);
        }

        .image-upload.drag-over {
            border-color: #667eea;
            background: #e8f2ff;
            transform: scale(1.05);
        }

        .image-upload p {
            font-size: 1.1rem;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .image-upload small {
            font-size: 0.9rem;
            color: #7f8c8d;
            margin: 0;
        }

        .image-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .image-item {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            aspect-ratio: 1;
        }

        .image-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .image-remove {
            position: absolute;
            top: 8px;
            right: 8px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            font-size: 16px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        .image-remove:hover,
        .image-remove:active {
            background: #c0392b;
            transform: scale(1.1);
        }

        .add-entry-btn {
            background: linear-gradient(45deg, #27ae60, #2ecc71);
            color: white;
            border: none;
            padding: 18px 30px;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin-bottom: 30px;
            min-height: 60px;
        }

        .add-entry-btn:hover,
        .add-entry-btn:active {
            transform: scale(0.98);
            box-shadow: 0 8px 25px rgba(39, 174, 96, 0.3);
        }

        .actions {
            display: flex;
            flex-direction: column;
            gap: 15px;
            justify-content: center;
        }

        .btn {
            padding: 18px 30px;
            border: none;
            border-radius: 15px;
            font-size: 1.2rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn-primary {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
        }

        .btn-secondary {
            background: linear-gradient(45deg, #f39c12, #e67e22);
            color: white;
        }

        .btn:hover,
        .btn:active {
            transform: scale(0.98);
            box-shadow: 0 8px 25px rgba(0,0,0,0.2);
        }

        .hidden {
            display: none;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 30px 20px;
            color: #667eea;
            font-weight: 600;
            font-size: 1.1rem;
            background: #f0f4ff;
            border-radius: 15px;
            margin: 20px 0;
        }

        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 20px;
            border-radius: 15px;
            margin: 20px 0;
            text-align: center;
            display: none;
            font-weight: 600;
            font-size: 1.1rem;
        }

        /* iOS Safari specific fixes */
        @supports (-webkit-touch-callout: none) {
            .input-group input,
            .input-group select,
            .text-area {
                font-size: 16px; /* Verhindert Zoom beim Fokus */
            }
        }

        /* Tablet Landscape */
        @media (min-width: 768px) and (max-width: 1024px) {
            .visit-info {
                grid-template-columns: 1fr 1fr;
            }
            
            .actions {
                flex-direction: row;
            }
            
            .container {
                max-width: 90%;
            }
        }

        /* Desktop */
        @media (min-width: 1025px) {
            body {
                padding: 20px;
            }
            
            .container {
                max-width: 900px;
            }
            
            .visit-info {
                grid-template-columns: 1fr 1fr;
            }
            
            .actions {
                flex-direction: row;
            }
            
            .content {
                padding: 30px;
            }
            
            .header {
                padding: 30px;
            }
            
            .header h1 {
                font-size: 2.2rem;
            }
            
            .header p {
                font-size: 1.1rem;
            }
        }

        /* Ultra-wide screens */
        @media (min-width: 1400px) {
            .image-preview {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            }
        }

        /* Accessibility improvements */
        @media (prefers-reduced-motion: reduce) {
            * {
                animation-duration: 0.01ms !important;
                animation-iteration-count: 1 !important;
                transition-duration: 0.01ms !important;
            }
        }

        /* Dark mode support */
        @media (prefers-color-scheme: dark) {
            .container {
                background: #1a1a1a;
                color: #ffffff;
            }
            
            .visit-info {
                background: #2d2d2d;
            }
            
            .entry-item {
                background: #2d2d2d;
                border-color: #404040;
            }
            
            .input-group input,
            .input-group select,
            .text-area {
                background: #2d2d2d;
                border-color: #404040;
                color: #ffffff;
            }
            
            .image-upload {
                background: #2d2d2d;
                border-color: #404040;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>📋 Filialbesuch Dokumentation</h1>
            <p>Erfassen Sie Ihre Beobachtungen und Notizen strukturiert</p>
        </div>
        
        <div class="content">
            <div class="visit-info">
                <div class="input-group">
                    <label for="visitDate">📅 Besuchsdatum:</label>
                    <input type="date" id="visitDate">
                </div>
                <div class="input-group">
                    <label for="branchName">🏪 Filialname:</label>
                    <select id="branchName">
                        <option value="">Filiale auswählen...</option>
                        <option value="Ahrensburg / Hamburger Str. 4-8 /(0727)">Ahrensburg / Hamburger Str. 4-8 /(0727)</option>
                        <option value="Ahrensburg / Rathausplatz 15 /(0174)">Ahrensburg / Rathausplatz 15 /(0174)</option>
                        <option value="Alsterdorf / Alsterdorfer Str. 206 /(0792)">Alsterdorf / Alsterdorfer Str. 206 /(0792)</option>
                        <option value="Altona-Altstadt / Holstenstraße 111 /(0193)">Altona-Altstadt / Holstenstraße 111 /(0193)</option>
                        <option value="Altona-Altstadt / Neue Große Bergstraße 18 /(0214)">Altona-Altstadt / Neue Große Bergstraße 18 /(0214)</option>
                        <option value="Altstadt / Bergstrasse 16 /(0101)">Altstadt / Bergstrasse 16 /(0101)</option>
                        <option value="Ammersbek / Hamburger Straße 101 /(0276)">Ammersbek / Hamburger Straße 101 /(0276)</option>
                        <option value="Apensen / Beckdorfer Straße 18 /(0190)">Apensen / Beckdorfer Straße 18 /(0190)</option>
                        <option value="Bad Oldesloe / Lübecker Straße 23-25 /(0230)">Bad Oldesloe / Lübecker Straße 23-25 /(0230)</option>
                        <option value="Bad Segeberg / Ziegelstrasse 105-107 /(0138)">Bad Segeberg / Ziegelstrasse 105-107 /(0138)</option>
                        <option value="Bahrenfeld / Gasstraße 6b /(0261)">Bahrenfeld / Gasstraße 6b /(0261)</option>
                        <option value="Bahrenfeld / Osdorfer Weg 106 /(0148)">Bahrenfeld / Osdorfer Weg 106 /(0148)</option>
                        <option value="Barendorf / Im Stadtkamp 1 /(0256)">Barendorf / Im Stadtkamp 1 /(0256)</option>
                        <option value="Bargteheide / Rathausstraße 13-15 /(0717)">Bargteheide / Rathausstraße 13-15 /(0717)</option>
                        <option value="Barmbek-Nord / Alter Güterbahnhof 2 /(0241)">Barmbek-Nord / Alter Güterbahnhof 2 /(0241)</option>
                        <option value="Barmbek-Nord / Fuhlsbüttler Str. 107-109 /(0301)">Barmbek-Nord / Fuhlsbüttler Str. 107-109 /(0301)</option>
                        <option value="Barmbek-Nord / Fuhlsbüttler Straße 164 /(0181)">Barmbek-Nord / Fuhlsbüttler Straße 164 /(0181)</option>
                        <option value="Barmbek-Nord / Fuhlsbüttler Straße 401 /(0164)">Barmbek-Nord / Fuhlsbüttler Straße 401 /(0164)</option>
                        <option value="Barmbek-Süd / Hamburger Str. 47-49 /(0764)">Barmbek-Süd / Hamburger Str. 47-49 /(0764)</option>
                        <option value="Barmbek-Süd / Mozartstraße 16 /(0168)">Barmbek-Süd / Mozartstraße 16 /(0168)</option>
                        <option value="Barsbüttel / Am Akku 9 /(0234)">Barsbüttel / Am Akku 9 /(0234)</option>
                        <option value="Bergedorf / Bergedorfer Str. 133 /(0407)">Bergedorf / Bergedorfer Str. 133 /(0407)</option>
                        <option value="Bergedorf / Friedrich-Frank-Bogen 166 /(0250)">Bergedorf / Friedrich-Frank-Bogen 166 /(0250)</option>
                        <option value="Bergedorf / Kupferhof 7 /(0757)">Bergedorf / Kupferhof 7 /(0757)</option>
                        <option value="Bergstedt / Wohldorfer Damm 1- 1a /(0253)">Bergstedt / Wohldorfer Damm 1- 1a /(0253)</option>
                        <option value="Berlin / Bundesalle 86/89 /0555">Berlin / Bundesalle 86/89 /0555</option>
                        <option value="Berlin / Frankfurter Allee 35-37 /0552">Berlin / Frankfurter Allee 35-37 /0552</option>
                        <option value="Berlin / Friedenstraße 90 /0556">Berlin / Friedenstraße 90 /0556</option>
                        <option value="Berlin / Friedrichstraße 149 /0554">Berlin / Friedrichstraße 149 /0554</option>
                        <option value="Berlin / Güntzelstraße 48 /0553">Berlin / Güntzelstraße 48 /0553</option>
                        <option value="Berlin / Martin Luther Straße 48 /0560">Berlin / Martin Luther Straße 48 /0560</option>
                        <option value="Berlin / Rankestraße 33-34 /0557">Berlin / Rankestraße 33-34 /0557</option>
                        <option value="Berlin / Revaler Straße 33 /0561">Berlin / Revaler Straße 33 /0561</option>
                        <option value="Berlin / Schönhauser Allee 12 /0551">Berlin / Schönhauser Allee 12 /0551</option>
                        <option value="Berlin / Schönhauser Allee 120 /0550">Berlin / Schönhauser Allee 120 /0550</option>
                        <option value="Berlin / Wilmersdorfer Straße 60 /0558">Berlin / Wilmersdorfer Straße 60 /0558</option>
                        <option value="Billstedt / Billstedter Platz 2 /(0183)">Billstedt / Billstedter Platz 2 /(0183)</option>
                        <option value="Blankenese / Propst-Paulsen-Str. 2 /(0208)">Blankenese / Propst-Paulsen-Str. 2 /(0208)</option>
                        <option value="Blankenese / Sülldorfer Kirchenweg 1-3 /(0761)">Blankenese / Sülldorfer Kirchenweg 1-3 /(0761)</option>
                        <option value="Börnsen / Hermann-Wöhlke-Weg 2 /(0191)">Börnsen / Hermann-Wöhlke-Weg 2 /(0191)</option>
                        <option value="Bramfeld / Bramfelder Chaussee 230 /(0165)">Bramfeld / Bramfelder Chaussee 230 /(0165)</option>
                        <option value="Bramfeld / Pezolddamm 147 /(0213)">Bramfeld / Pezolddamm 147 /(0213)</option>
                        <option value="Büchen / Schlickweg 2 /(0287)">Büchen / Schlickweg 2 /(0287)</option>
                        <option value="Buchholz / Breite Str. 5 /(0707)">Buchholz / Breite Str. 5 /(0707)</option>
                        <option value="Buchholz / Soltauer Straße 93 /(0196)">Buchholz / Soltauer Straße 93 /(0196)</option>
                        <option value="Buxtehude / Stader Straße 2 /(0788)">Buxtehude / Stader Straße 2 /(0788)</option>
                        <option value="Buxtehude / Zwischen den Brücken 1 /(0748)">Buxtehude / Zwischen den Brücken 1 /(0748)</option>
                        <option value="Dollern / Am Buschteich 26 /(0255)">Dollern / Am Buschteich 26 /(0255)</option>
                        <option value="Duvenstedt / Poppenbüttler Chaussee 36 /(0155)">Duvenstedt / Poppenbüttler Chaussee 36 /(0155)</option>
                        <option value="Eidelstedt / Eidelstedter Platz 1 /(0731)">Eidelstedt / Eidelstedter Platz 1 /(0731)</option>
                        <option value="Eilbek / Conventstraße 8-10 /(0262)">Eilbek / Conventstraße 8-10 /(0262)</option>
                        <option value="Eilbek / Landwehr 34 /(0713)">Eilbek / Landwehr 34 /(0713)</option>
                        <option value="Eimsbüttel / Eimsbütteler Chaussee 85 /(0216)">Eimsbüttel / Eimsbütteler Chaussee 85 /(0216)</option>
                        <option value="Eimsbüttel / Müggenkampstraße 4 /(0775)">Eimsbüttel / Müggenkampstraße 4 /(0775)</option>
                        <option value="Eimsbüttel / Osterstr. 1 /(0122)">Eimsbüttel / Osterstr. 1 /(0122)</option>
                        <option value="Eimsbüttel / Osterstr. 95 /(0203)">Eimsbüttel / Osterstr. 95 /(0203)</option>
                        <option value="Eppendorf / Eppendorfer Baum 39 /(0602)">Eppendorf / Eppendorfer Baum 39 /(0602)</option>
                        <option value="Eppendorf / Eppendorfer Landstr. 67 /(0711)">Eppendorf / Eppendorfer Landstr. 67 /(0711)</option>
                        <option value="Eppendorf / Eppendorfer Landstrasse 77 /(0145)">Eppendorf / Eppendorfer Landstrasse 77 /(0145)</option>
                        <option value="Eppendorf / Martinistraße 64 /(0200)">Eppendorf / Martinistraße 64 /(0200)</option>
                        <option value="Farmsen-Berne / Berner Heerweg 173-175 /(0603)">Farmsen-Berne / Berner Heerweg 173-175 /(0603)</option>
                        <option value="Finkenwerder / Steendiek 43 /(0708)">Finkenwerder / Steendiek 43 /(0708)</option>
                        <option value="Fuhlsbüttel / Erdkampsweg 47-49 /(0755)">Fuhlsbüttel / Erdkampsweg 47-49 /(0755)</option>
                        <option value="Geesthacht / Norderstraße 16 /(0270)">Geesthacht / Norderstraße 16 /(0270)</option>
                        <option value="Glinde / Markt 3 /(0410)">Glinde / Markt 3 /(0410)</option>
                        <option value="Groß Borstel / Borsteler Chaussee 111-113 /(0747)">Groß Borstel / Borsteler Chaussee 111-113 /(0747)</option>
                        <option value="Gross Flottbek / Waitzstrasse 29 /(0140)">Gross Flottbek / Waitzstrasse 29 /(0140)</option>
                        <option value="Grosshansdorf / Eilbergweg 11 /(0218)">Grosshansdorf / Eilbergweg 11 /(0218)</option>
                        <option value="HafenCity / Überseeboulevard 7 /(0281)">HafenCity / Überseeboulevard 7 /(0281)</option>
                        <option value="Halstenbek / Seestrasse 250 /(0147)">Halstenbek / Seestrasse 250 /(0147)</option>
                        <option value="Hamm / Hammer Landstraße 84 /(0279)">Hamm / Hammer Landstraße 84 /(0279)</option>
                        <option value="Hamm-Mitte / Droopweg 25 /(0152)">Hamm-Mitte / Droopweg 25 /(0152)</option>
                        <option value="Hamm-Nord / Hammer Steindamm 72-74 /(0192)">Hamm-Nord / Hammer Steindamm 72-74 /(0192)</option>
                        <option value="Hammerbrook / Sonninstraße 1-5 /(0278)">Hammerbrook / Sonninstraße 1-5 /(0278)</option>
                        <option value="Hanstedt / Winsener Straße 1-3 /(0264)">Hanstedt / Winsener Straße 1-3 /(0264)</option>
                        <option value="Harburg / Hannoversche Straße 86 /(0273)">Harburg / Hannoversche Straße 86 /(0273)</option>
                        <option value="Harburg / Lüneburger Str. 39 /(0737)">Harburg / Lüneburger Str. 39 /(0737)</option>
                        <option value="Harburg / Sand 10 /(0501)">Harburg / Sand 10 /(0501)</option>
                        <option value="Harsefeld / Buxtehuder Str. 11 /(0735)">Harsefeld / Buxtehuder Str. 11 /(0735)</option>
                        <option value="Harvestehude / Grindelberg 7 /(0151)">Harvestehude / Grindelberg 7 /(0151)</option>
                        <option value="Heimfeld / Heimfelder Str. 46 /(0766)">Heimfeld / Heimfelder Str. 46 /(0766)</option>
                        <option value="Heimfeld / Stader Straße 136 /(0231)">Heimfeld / Stader Straße 136 /(0231)</option>
                        <option value="Henstedt-Ulzburg / Dammstücken 29-33 /(0274)">Henstedt-Ulzburg / Dammstücken 29-33 /(0274)</option>
                        <option value="Hittfeld / Kirchstrasse 26 /(0172)">Hittfeld / Kirchstrasse 26 /(0172)</option>
                        <option value="Hoheluft-Ost / Eppendorfer Baum 42 /(0804)">Hoheluft-Ost / Eppendorfer Baum 42 /(0804)</option>
                        <option value="Hoheluft-Ost / Hoheluftchaussee 52 /(0212)">Hoheluft-Ost / Hoheluftchaussee 52 /(0212)</option>
                        <option value="Horn / Graßmannweg 6-13 /(0219)">Horn / Graßmannweg 6-13 /(0219)</option>
                        <option value="Horn / Rennbahnstr. 30-38 /(0723)">Horn / Rennbahnstr. 30-38 /(0723)</option>
                        <option value="Hummelsbüttel / Hummelsbüttler Hauptstr. 62 /(0127)">Hummelsbüttel / Hummelsbüttler Hauptstr. 62 /(0127)</option>
                        <option value="Jesteburg / Brückenstraße 11 /(0217)">Jesteburg / Brückenstraße 11 /(0217)</option>
                        <option value="Kaltenkirchen / Am Bahnhof 2-12 /(0763)">Kaltenkirchen / Am Bahnhof 2-12 /(0763)</option>
                        <option value="Keitum / Keitumer Landstraße 10a-c /(0801)">Keitum / Keitumer Landstraße 10a-c /(0801)</option>
                        <option value="Langenhorn / Krohnstieg 41-43 /(0269)">Langenhorn / Krohnstieg 41-43 /(0269)</option>
                        <option value="Langenhorn / Langenhorner Chaussee 666 /(0238)">Langenhorn / Langenhorner Chaussee 666 /(0238)</option>
                        <option value="Lohbrügge / Am Beckerkamp 17 /(0291)">Lohbrügge / Am Beckerkamp 17 /(0291)</option>
                        <option value="Lohbrügge / Heidhorst 4 /(0226)">Lohbrügge / Heidhorst 4 /(0226)</option>
                        <option value="Lokstedt / Vogt-Wells-Straße 6 /(0229)">Lokstedt / Vogt-Wells-Straße 6 /(0229)</option>
                        <option value="Lübeck / Heiligen-Geist-Kamp 4 /(0235)">Lübeck / Heiligen-Geist-Kamp 4 /(0235)</option>
                        <option value="Lübeck / Mühlenstraße 22-24 /(0286)">Lübeck / Mühlenstraße 22-24 /(0286)</option>
                        <option value="Lüneburg / Am Sande 50 /(0738)">Lüneburg / Am Sande 50 /(0738)</option>
                        <option value="Lüneburg / Bei der Keulahütte 1 /(0793)">Lüneburg / Bei der Keulahütte 1 /(0793)</option>
                        <option value="Lüneburg / Feldstrasse 1 /(0128)">Lüneburg / Feldstrasse 1 /(0128)</option>
                        <option value="Lurup / Elbgaustrasse 128 /(0153)">Lurup / Elbgaustrasse 128 /(0153)</option>
                        <option value="Lurup / Luruper Hauptstraße 272a /(0194)">Lurup / Luruper Hauptstraße 272a /(0194)</option>
                        <option value="Marienthal / Rennbahnstrasse 135 /(0136)">Marienthal / Rennbahnstrasse 135 /(0136)</option>
                        <option value="Marmstorf / Ernst-Bergeest-Weg 57 a /(0705)">Marmstorf / Ernst-Bergeest-Weg 57 a /(0705)</option>
                        <option value="Maschen / Schulstraße 38 /(0237)">Maschen / Schulstraße 38 /(0237)</option>
                        <option value="Meckelfeld / Am Saal 20 /(0123)">Meckelfeld / Am Saal 20 /(0123)</option>
                        <option value="Mölln / Grambeker Weg 91-93 /(0124)">Mölln / Grambeker Weg 91-93 /(0124)</option>
                        <option value="Mundsburg Center / Hamburger Straße 1-15 /(0179)">Mundsburg Center / Hamburger Straße 1-15 /(0179)</option>
                        <option value="Nahe / Segeberger Strasse 30 /(0173)">Nahe / Segeberger Strasse 30 /(0173)</option>
                        <option value="Neu Wulmstorf / Wulmstorfer Wiesen 2a /(0185)">Neu Wulmstorf / Wulmstorfer Wiesen 2a /(0185)</option>
                        <option value="Neuengamme / Heinrich-Stubbe-Weg 13-15 /(0254)">Neuengamme / Heinrich-Stubbe-Weg 13-15 /(0254)</option>
                        <option value="Neugraben-Fischbek / Lütt Enn 3 /(0505)">Neugraben-Fischbek / Lütt Enn 3 /(0505)</option>
                        <option value="Neustadt / Dammtorstr. 33-35 /(0784)">Neustadt / Dammtorstr. 33-35 /(0784)</option>
                        <option value="Neustadt / Wexstr. 25 /(0760)">Neustadt / Wexstr. 25 /(0760)</option>
                        <option value="Neuwiedenthal / Rehrstieg 28 /(0225)">Neuwiedenthal / Rehrstieg 28 /(0225)</option>
                        <option value="Niedermarschacht / Elbuferstrasse 116 /(0159)">Niedermarschacht / Elbuferstrasse 116 /(0159)</option>
                        <option value="Niendorf / Paul-Sorge-Str. 8 /(0730)">Niendorf / Paul-Sorge-Str. 8 /(0730)</option>
                        <option value="Niendorf / Wagrier Weg 2-8 /(0149)">Niendorf / Wagrier Weg 2-8 /(0149)</option>
                        <option value="Nienstedten / Nienstedtener Straße 2e /(0215)">Nienstedten / Nienstedtener Straße 2e /(0215)</option>
                        <option value="Norderstedt / Berliner Allee 42 /(0753)">Norderstedt / Berliner Allee 42 /(0753)</option>
                        <option value="Norderstedt / Rathausallee 31a/33a /(0252)">Norderstedt / Rathausallee 31a/33a /(0252)</option>
                        <option value="Norderstedt / Schmuggelstieg 6 /(0309)">Norderstedt / Schmuggelstieg 6 /(0309)</option>
                        <option value="Norderstedt / Ulzburger Strasse 360 /(0150)">Norderstedt / Ulzburger Strasse 360 /(0150)</option>
                        <option value="Osdorf / Osdorfer Landstrasse 131-135 /(0129)">Osdorf / Osdorfer Landstrasse 131-135 /(0129)</option>
                        <option value="Osdorf / Rugenbarg 18 /(0239)">Osdorf / Rugenbarg 18 /(0239)</option>
                        <option value="Oststeinbek / Möllner Landstrasse 30 /(0144)">Oststeinbek / Möllner Landstrasse 30 /(0144)</option>
                        <option value="Othmarschen / Jürgen-Töpfer-Straße 18 /(0224)">Othmarschen / Jürgen-Töpfer-Straße 18 /(0224)</option>
                        <option value="Ottensen / Bahrenfelder Straße 134 /(0266)">Ottensen / Bahrenfelder Straße 134 /(0266)</option>
                        <option value="Ottensen / Ottenser Hauptstraße 10 /(0187)">Ottensen / Ottenser Hauptstraße 10 /(0187)</option>
                        <option value="Pinneberg / Richard-Köhn-Str. 1 /(0796)">Pinneberg / Richard-Köhn-Str. 1 /(0796)</option>
                        <option value="Poppenbüttel / Heegbarg 31 /(0762)">Poppenbüttel / Heegbarg 31 /(0762)</option>
                        <option value="Poppenbüttel / Moorhof 7a /(0781)">Poppenbüttel / Moorhof 7a /(0781)</option>
                        <option value="Poppenbüttel / Poppenbütteler Bogen 98 /(0289)">Poppenbüttel / Poppenbütteler Bogen 98 /(0289)</option>
                        <option value="Quickborn / Bahnhofstraße 104 /(0746)">Quickborn / Bahnhofstraße 104 /(0746)</option>
                        <option value="Rahlstedt / Bargteheider Straße 20-22 /(0220)">Rahlstedt / Bargteheider Straße 20-22 /(0220)</option>
                        <option value="Rahlstedt / Meiendorfer Strasse 89 /(0135)">Rahlstedt / Meiendorfer Strasse 89 /(0135)</option>
                        <option value="Rahlstedt / Rahlstedter Bahnhofstrasse 17 /(0176)">Rahlstedt / Rahlstedter Bahnhofstrasse 17 /(0176)</option>
                        <option value="Rahlstedt / Scharbeutzer Straße 102a-c /(0236)">Rahlstedt / Scharbeutzer Straße 102a-c /(0236)</option>
                        <option value="Rahlstedt / Schweriner Strasse 8-12 /(0141)">Rahlstedt / Schweriner Strasse 8-12 /(0141)</option>
                        <option value="Reinbek / Am Ladenzentrum 7 /(0126)">Reinbek / Am Ladenzentrum 7 /(0126)</option>
                        <option value="Reinbek / Sachsenwaldstr. 20 /(0791)">Reinbek / Sachsenwaldstr. 20 /(0791)</option>
                        <option value="Rellingen / Hauptstrasse 105 /(0133)">Rellingen / Hauptstrasse 105 /(0133)</option>
                        <option value="Rissen / Wedeler Landstraße 56 /(0242)">Rissen / Wedeler Landstraße 56 /(0242)</option>
                        <option value="Rothenburgsort / Lindleystraße 2 /(0782)">Rothenburgsort / Lindleystraße 2 /(0782)</option>
                        <option value="Rotherbaum / Grindelallee 110-114 /(0201)">Rotherbaum / Grindelallee 110-114 /(0201)</option>
                        <option value="Rotherbaum / Milchstraße 1 /(0785)">Rotherbaum / Milchstraße 1 /(0785)</option>
                        <option value="Rotherbaum / Mittelweg 126 /(0805)">Rotherbaum / Mittelweg 126 /(0805)</option>
                        <option value="Sasel / Saseler Markt 14a /(0228)">Sasel / Saseler Markt 14a /(0228)</option>
                        <option value="Schenefeld / Industriestraße 1 /(0188)">Schenefeld / Industriestraße 1 /(0188)</option>
                        <option value="Schnelsen / Frohmestraße 48 /(0198)">Schnelsen / Frohmestraße 48 /(0198)</option>
                        <option value="Schwarzenbek / Compestrasse 1 /(0146)">Schwarzenbek / Compestrasse 1 /(0146)</option>
                        <option value="St. Georg / Schmilinskystraße 15 /(0802)">St. Georg / Schmilinskystraße 15 /(0802)</option>
                        <option value="St. Pauli / Clemens-Schultz-Strasse 38 /(0104)">St. Pauli / Clemens-Schultz-Strasse 38 /(0104)</option>
                        <option value="St. Pauli / Neuer Kamp 31 /(0233)">St. Pauli / Neuer Kamp 31 /(0233)</option>
                        <option value="St. Pauli / Talstraße 36 /(0774)">St. Pauli / Talstraße 36 /(0774)</option>
                        <option value="St.Georg / Lange Reihe 104-106 /(0175)">St.Georg / Lange Reihe 104-106 /(0175)</option>
                        <option value="St.Georg / Lange Reihe 18-20 /(0178)">St.Georg / Lange Reihe 18-20 /(0178)</option>
                        <option value="St.Georg / Steindamm 55 /(0282)">St.Georg / Steindamm 55 /(0282)</option>
                        <option value="Stade / Steile Straße 1 /(0248)">Stade / Steile Straße 1 /(0248)</option>
                        <option value="Steilshoop / Steilshooper Str. 281 /(0773)">Steilshoop / Steilshooper Str. 281 /(0773)</option>
                        <option value="Stelle / Harburger Straße 25 c /(0772)">Stelle / Harburger Straße 25 c /(0772)</option>
                        <option value="Stellingen / Kieler Str. 561-573 /(0745)">Stellingen / Kieler Str. 561-573 /(0745)</option>
                        <option value="Stellingen / Langenfelder Damm 62 /(0767)">Stellingen / Langenfelder Damm 62 /(0767)</option>
                        <option value="Sternschanze / Schanzenstraße 55 /(0768)">Sternschanze / Schanzenstraße 55 /(0768)</option>
                        <option value="Sternschanze / Schulterblatt 135 /(0268)">Sternschanze / Schulterblatt 135 /(0268)</option>
                        <option value="Sternschanze / Schulterblatt 45 /(0105)">Sternschanze / Schulterblatt 45 /(0105)</option>
                        <option value="Tangstedt / Eichholzkoppel 1 /(0267)">Tangstedt / Eichholzkoppel 1 /(0267)</option>
                        <option value="Timmendorfer STrand / Strandallee 81 /(0290)">Timmendorfer STrand / Strandallee 81 /(0290)</option>
                        <option value="Tonndorf / Ahrensburger Strasse 150-152 /(0131)">Tonndorf / Ahrensburger Strasse 150-152 /(0131)</option>
                        <option value="Tornesch / Ohlenhoff 4 /(0184)">Tornesch / Ohlenhoff 4 /(0184)</option>
                        <option value="Tostedt / Unter den Linden 5 /(0758)">Tostedt / Unter den Linden 5 /(0758)</option>
                        <option value="Tostedt / Zinnhütte 12 /(0280)">Tostedt / Zinnhütte 12 /(0280)</option>
                        <option value="Trittau / Poststraße 27-29 /(0245)">Trittau / Poststraße 27-29 /(0245)</option>
                        <option value="Uhlenhorst / Hofweg 46-48 /(0180)">Uhlenhorst / Hofweg 46-48 /(0180)</option>
                        <option value="Volksdorf / Claus-Ferck-Straße 8 /(0186)">Volksdorf / Claus-Ferck-Straße 8 /(0186)</option>
                        <option value="Volksdorf / Weiße Rose 8 /(0795)">Volksdorf / Weiße Rose 8 /(0795)</option>
                        <option value="Wandsbek / Friedrich-Ebert-Damm 79-85 /(0221)">Wandsbek / Friedrich-Ebert-Damm 79-85 /(0221)</option>
                        <option value="Wandsbek / Wandsbeker Marktstraße 103-107 /(0272)">Wandsbek / Wandsbeker Marktstraße 103-107 /(0272)</option>
                        <option value="Wandsbek / Wandsbeker Marktstraße 2 /(0288)">Wandsbek / Wandsbeker Marktstraße 2 /(0288)</option>
                        <option value="Wedel / Am Marienhof 1, 3 /(0263)">Wedel / Am Marienhof 1, 3 /(0263)</option>
                        <option value="Wedel / Bahnhofstraße 31 /(0776)">Wedel / Bahnhofstraße 31 /(0776)</option>
                        <option value="Wedel / Rissener Straße 125 /(0257)">Wedel / Rissener Straße 125 /(0257)</option>
                        <option value="Wellingsbüttel / Wellingsbüttler Weg 125 /(0177)">Wellingsbüttel / Wellingsbüttler Weg 125 /(0177)</option>
                        <option value="Wenningstedt/Sylt / Osterweg 2 /(0771)">Wenningstedt/Sylt / Osterweg 2 /(0771)</option>
                        <option value="Wentorf / Berliner Landstraße 4-6 /(0249)">Wentorf / Berliner Landstraße 4-6 /(0249)</option>
                        <option value="Wilhelmsburg / Vogelhüttendeich 48 /(0756)">Wilhelmsburg / Vogelhüttendeich 48 /(0756)</option>
                        <option value="Wilhelmsburg / Wilhelm-Strauß-Weg 2b /(0736)">Wilhelmsburg / Wilhelm-Strauß-Weg 2b /(0736)</option>
                        <option value="Winsen / Löhnfeld 10 /(0740)">Winsen / Löhnfeld 10 /(0740)</option>
                        <option value="Winsen / Rathausstraße 33 /(0197)">Winsen / Rathausstraße 33 /(0197)</option>
                        <option value="Winterhude / Gertigstraße 24 /(0275)">Winterhude / Gertigstraße 24 /(0275)</option>
                        <option value="Winterhude / Hudtwalckerstr. 19-21 /(0304)">Winterhude / Hudtwalckerstr. 19-21 /(0304)</option>
                        <option value="Winterhude / Jarrestr. 47 /(0749)">Winterhude / Jarrestr. 47 /(0749)</option>
                        <option value="Winterhude / Mühlenkamp 43 /(0305)">Winterhude / Mühlenkamp 43 /(0305)</option>
                    </select>
                </div>
                <div class="input-group">
                    <label for="visitorName">👤 Besucher:</label>
                    <input type="text" id="visitorName" placeholder="Ihr Name (wird für Session gespeichert)">
                </div>
                <div class="input-group">
                    <label for="visitTime">⏰ Uhrzeit:</label>
                    <input type="time" id="visitTime">
                </div>
            </div>

            <div id="entriesContainer">
                <div class="entry-item" data-entry="1">
                    <div class="entry-header">
                        <span class="entry-number">Punkt 1</span>
                        <button class="delete-btn hidden" onclick="deleteEntry(this)" aria-label="Punkt 1 löschen">🗑️ Löschen</button>
                    </div>
                    
                    <textarea class="text-area" placeholder="Beschreiben Sie hier Ihre Beobachtungen, Notizen oder Anmerkungen..." aria-label="Notizen für Punkt 1"></textarea>
                    
                    <div class="image-upload" onclick="document.getElementById('imageInput-1').click()" role="button" tabindex="0" aria-label="Bilder für ersten Punkt hinzufügen">
                        <p>📷 Tippen Sie hier um Bilder hinzuzufügen</p>
                        <small>Unterstützte Formate: JPG, PNG, GIF</small>
                        <input type="file" id="imageInput-1" class="hidden" multiple accept="image/*" onchange="handleImageUpload(this, 1)" aria-label="Bilddateien auswählen">
                    </div>
                    
                    <div class="image-preview" id="imagePreview-1" aria-live="polite"></div>
                </div>
            </div>

            <button class="add-entry-btn" onclick="addEntry()" aria-label="Neuen Dokumentationspunkt hinzufügen">
                ➕ Weiteren Punkt hinzufügen
            </button>

            <div class="loading" id="loading">
                📄 PDF wird erstellt...
            </div>

            <div class="success-message" id="successMessage">
                ✅ PDF erfolgreich erstellt und heruntergeladen!
            </div>

            <div class="actions">
                <button class="btn btn-primary" onclick="generatePDF()" aria-label="PDF-Bericht erstellen und herunterladen">
                    📄 PDF erstellen
                </button>
                <button class="btn btn-secondary" onclick="resetForm()" aria-label="Alle Eingaben zurücksetzen">
                    🔄 Zurücksetzen
                </button>
            </div>
        </div>
    </div>

    <script>
        let entryCounter = 1;
        let imageData = {};
        let savedVisitorName = '';
        let userLocation = null;
        let isLocationDetected = false;

        // Datum auf heute setzen
        document.getElementById('visitDate').valueAsDate = new Date();
        
        // Aktuelle Zeit setzen
        const now = new Date();
        document.getElementById('visitTime').value = now.toTimeString().slice(0,5);

        // Standort-basierte Filialvorschläge
        const filialLocations = {
            'Hamburg': {
                lat: 53.5511,
                lng: 9.9937,
                keywords: ['Ahrensburg', 'Alsterdorf', 'Altona', 'Altstadt', 'Ammersbek', 'Bahrenfeld', 'Bargteheide', 'Barmbek', 'Barsbüttel', 'Bergedorf', 'Bergstedt', 'Billstedt', 'Blankenese', 'Börnsen', 'Bramfeld', 'Duvenstedt', 'Eidelstedt', 'Eilbek', 'Eimsbüttel', 'Eppendorf', 'Farmsen', 'Finkenwerder', 'Fuhlsbüttel', 'Glinde', 'Groß Borstel', 'Gross Flottbek', 'Grosshansdorf', 'HafenCity', 'Halstenbek', 'Hamm', 'Hammerbrook', 'Harburg', 'Harvestehude', 'Heimfeld', 'Hittfeld', 'Hoheluft', 'Horn', 'Hummelsbüttel', 'Langenhorn', 'Lohbrügge', 'Lokstedt', 'Lurup', 'Marienthal', 'Marmstorf', 'Maschen', 'Meckelfeld', 'Mundsburg', 'Neu Wulmstorf', 'Neuengamme', 'Neugraben', 'Neustadt', 'Neuwiedenthal', 'Niedermarschacht', 'Niendorf', 'Nienstedten', 'Norderstedt', 'Osdorf', 'Oststeinbek', 'Othmarschen', 'Ottensen', 'Pinneberg', 'Poppenbüttel', 'Quickborn', 'Rahlstedt', 'Reinbek', 'Rellingen', 'Rissen', 'Rothenburgsort', 'Rotherbaum', 'Sasel', 'Schenefeld', 'Schnelsen', 'St. Georg', 'St. Pauli', 'Steilshoop', 'Stelle', 'Stellingen', 'Sternschanze', 'Tangstedt', 'Tonndorf', 'Tornesch', 'Trittau', 'Uhlenhorst', 'Volksdorf', 'Wandsbek', 'Wedel', 'Wellingsbüttel', 'Wentorf', 'Wilhelmsburg', 'Winterhude']
            },
            'Berlin': {
                lat: 52.5200,
                lng: 13.4050,
                keywords: ['Berlin']
            },
            'Lübeck': {
                lat: 53.8648,
                lng: 10.6865,
                keywords: ['Lübeck', 'Bad Oldesloe', 'Bad Segeberg', 'Büchen', 'Mölln', 'Schwarzenbek']
            },
            'Lüneburg': {
                lat: 53.2493,
                lng: 10.4070,
                keywords: ['Lüneburg', 'Buchholz', 'Hanstedt', 'Jesteburg', 'Tostedt', 'Winsen']
            },
            'Buxtehude': {
                lat: 53.4774,
                lng: 9.6951,
                keywords: ['Buxtehude', 'Apensen', 'Dollern', 'Harsefeld', 'Stade']
            },
            'Sylt': {
                lat: 54.9079,
                lng: 8.3147,
                keywords: ['Wenningstedt', 'Sylt', 'Keitum']
            },
            'Timmendorfer Strand': {
                lat: 54.0079,
                lng: 10.7717,
                keywords: ['Timmendorfer STrand']
            },
            'Geesthacht': {
                lat: 53.4308,
                lng: 10.3695,
                keywords: ['Geesthacht']
            },
            'Kaltenkirchen': {
                lat: 53.8386,
                lng: 9.9717,
                keywords: ['Kaltenkirchen', 'Henstedt-Ulzburg', 'Nahe']
            }
        };

        // Geolocation initialisieren
        function initGeolocation() {
            if (navigator.geolocation) {
                // Subtile Standort-Anfrage
                navigator.geolocation.getCurrentPosition(
                    function(position) {
                        userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };
                        sortFilialsByLocation();
                        isLocationDetected = true;
                        
                        // Dezenter Hinweis
                        showLocationHint('📍 Filialen nach Nähe sortiert');
                    },
                    function(error) {
                        // Fehler stillschweigend ignorieren - kein störender Alert
                        console.log('Standort nicht verfügbar:', error.message);
                    },
                    {
                        enableHighAccuracy: false,
                        timeout: 5000,
                        maximumAge: 300000 // 5 Minuten Cache
                    }
                );
            }
        }

        // Distanz zwischen zwei Koordinaten berechnen (Haversine Formel)
        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371; // Erdradius in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                      Math.sin(dLng/2) * Math.sin(dLng/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            return R * c;
        }

        // Nächste Region finden
        function findNearestRegion() {
            if (!userLocation) return null;
            
            let nearestRegion = null;
            let minDistance = Infinity;
            
            for (const [region, data] of Object.entries(filialLocations)) {
                const distance = calculateDistance(
                    userLocation.lat, userLocation.lng,
                    data.lat, data.lng
                );
                
                if (distance < minDistance) {
                    minDistance = distance;
                    nearestRegion = region;
                }
            }
            
            return nearestRegion;
        }

        // Filialen nach Standort sortieren
        function sortFilialsByLocation() {
            const select = document.getElementById('branchName');
            const options = Array.from(select.options).slice(1); // Erste Option ("Filiale auswählen") ausschließen
            
            const nearestRegion = findNearestRegion();
            if (!nearestRegion) return;
            
            const regionKeywords = filialLocations[nearestRegion].keywords;
            
            // Sortiere Optionen: Nahe Filialen zuerst
            options.sort((a, b) => {
                const aIsNear = regionKeywords.some(keyword => 
                    a.value.toLowerCase().includes(keyword.toLowerCase())
                );
                const bIsNear = regionKeywords.some(keyword => 
                    b.value.toLowerCase().includes(keyword.toLowerCase())
                );
                
                if (aIsNear && !bIsNear) return -1;
                if (!aIsNear && bIsNear) return 1;
                return 0; // Ursprüngliche Reihenfolge beibehalten
            });
            
            // Dropdown neu aufbauen
            select.innerHTML = '<option value="">📍 Filiale auswählen...</option>';
            
            // Gruppierung mit Trennlinie
            let nearOptionsAdded = false;
            options.forEach(option => {
                const isNear = regionKeywords.some(keyword => 
                    option.value.toLowerCase().includes(keyword.toLowerCase())
                );
                
                if (isNear && !nearOptionsAdded) {
                    const separator = document.createElement('option');
                    separator.disabled = true;
                    separator.textContent = `──── 📍 Nahe ${nearestRegion} ────`;
                    select.appendChild(separator);
                    nearOptionsAdded = true;
                } else if (!isNear && nearOptionsAdded) {
                    const separator = document.createElement('option');
                    separator.disabled = true;
                    separator.textContent = '──── 🏢 Weitere Filialen ────';
                    select.appendChild(separator);
                    nearOptionsAdded = false; // Reset für weitere Gruppierungen
                }
                
                select.appendChild(option);
            });
        }

        // Dezenter Standort-Hinweis
        function showLocationHint(message) {
            const label = document.querySelector('label[for="branchName"]');
            const originalText = label.textContent;
            
            label.style.color = '#27ae60';
            label.textContent = `🏪 ${message}`;
            
            setTimeout(() => {
                label.style.color = '';
                label.textContent = originalText;
            }, 3000);
        }

        // Namen aus vorherigen Eingaben wiederverwenden
        document.getElementById('visitorName').addEventListener('blur', function() {
            savedVisitorName = this.value;
        });

        // Verbessertes Touch-Feedback für alle Buttons
        function addTouchFeedback() {
            const buttons = document.querySelectorAll('button, .image-upload, .btn');
            
            buttons.forEach(button => {
                // Entferne alte Event Listener um Duplikate zu vermeiden
                button.removeEventListener('touchstart', handleTouchStart);
                button.removeEventListener('touchend', handleTouchEnd);
                button.removeEventListener('touchcancel', handleTouchCancel);
                
                button.addEventListener('touchstart', handleTouchStart, { passive: true });
                button.addEventListener('touchend', handleTouchEnd, { passive: true });
                button.addEventListener('touchcancel', handleTouchCancel, { passive: true });
            });
        }

        function handleTouchStart(e) {
            this.style.transform = 'scale(0.95)';
            this.style.transition = 'transform 0.1s ease';
        }

        function handleTouchEnd(e) {
            setTimeout(() => {
                this.style.transform = 'scale(1)';
            }, 50);
        }

        function handleTouchCancel(e) {
            this.style.transform = 'scale(1)';
        }

        // Mobile-optimierte Scroll-Funktion
        function scrollToElement(element) {
            if (element) {
                element.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }

        function addEntry() {
            entryCounter++;
            const container = document.getElementById('entriesContainer');
            
            const entryDiv = document.createElement('div');
            entryDiv.className = 'entry-item';
            entryDiv.setAttribute('data-entry', entryCounter);
            
            entryDiv.innerHTML = `
                <div class="entry-header">
                    <span class="entry-number">Punkt ${entryCounter}</span>
                    <button class="delete-btn" onclick="deleteEntry(this)" aria-label="Punkt ${entryCounter} löschen">🗑️ Löschen</button>
                </div>
                
                <textarea class="text-area" placeholder="Beschreiben Sie hier Ihre Beobachtungen, Notizen oder Anmerkungen..." aria-label="Notizen für Punkt ${entryCounter}"></textarea>
                
                <div class="image-upload" onclick="document.getElementById('imageInput-${entryCounter}').click()" role="button" tabindex="0" aria-label="Bilder für Punkt ${entryCounter} hinzufügen">
                    <p>📷 Tippen Sie hier um Bilder hinzuzufügen</p>
                    <small>Unterstützte Formate: JPG, PNG, GIF</small>
                    <input type="file" id="imageInput-${entryCounter}" class="hidden" multiple accept="image/*" onchange="handleImageUpload(this, ${entryCounter})" aria-label="Bilddateien auswählen">
                </div>
                
                <div class="image-preview" id="imagePreview-${entryCounter}" aria-live="polite"></div>
            `;
            
            container.appendChild(entryDiv);
            
            // Mobile-optimierte Initialisierung
            setupDragAndDrop(entryDiv.querySelector('.image-upload'), entryCounter);
            addTouchFeedback();
            updateDeleteButtons();
            
            // Sanft zum neuen Element scrollen
            setTimeout(() => {
                scrollToElement(entryDiv);
            }, 100);
        }

        // Mobile-optimierte Initialisierung
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop(document.querySelector('.image-upload'), 1);
            addTouchFeedback();
            
            // Standort-basierte Filialvorschläge initialisieren
            setTimeout(() => {
                initGeolocation();
            }, 1000); // Kurze Verzögerung für bessere UX
            
            // Viewport-Meta für mobile Optimierung prüfen
            if (!document.querySelector('meta[name="viewport"]')) {
                const viewport = document.createElement('meta');
                viewport.name = 'viewport';
                viewport.content = 'width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no';
                document.head.appendChild(viewport);
            }
            
            // iOS Safari Scrolling-Verbesserung
            if (navigator.userAgent.includes('Safari') && navigator.userAgent.includes('Mobile')) {
                document.body.style.webkitOverflowScrolling = 'touch';
            }
        });

        function deleteEntry(button) {
            const entry = button.closest('.entry-item');
            const entryNumber = entry.getAttribute('data-entry');
            
            // Bilder aus imageData entfernen
            delete imageData[entryNumber];
            
            entry.remove();
            updateDeleteButtons();
            renumberEntries();
        }

        function updateDeleteButtons() {
            const entries = document.querySelectorAll('.entry-item');
            entries.forEach((entry, index) => {
                const deleteBtn = entry.querySelector('.delete-btn');
                if (entries.length > 1) {
                    deleteBtn.classList.remove('hidden');
                } else {
                    deleteBtn.classList.add('hidden');
                }
            });
        }

        function renumberEntries() {
            const entries = document.querySelectorAll('.entry-item');
            entries.forEach((entry, index) => {
                const number = index + 1;
                entry.setAttribute('data-entry', number);
                entry.querySelector('.entry-number').textContent = `Punkt ${number}`;
            });
        }

        function handleImageUpload(input, entryNumber) {
            const files = input.files;
            const preview = document.getElementById(`imagePreview-${entryNumber}`);
            
            if (!imageData[entryNumber]) {
                imageData[entryNumber] = [];
            }
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageInfo = {
                            src: e.target.result,
                            name: file.name
                        };
                        
                        imageData[entryNumber].push(imageInfo);
                        displayImage(entryNumber, imageInfo, imageData[entryNumber].length - 1);
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        function displayImage(entryNumber, imageInfo, index) {
            const preview = document.getElementById(`imagePreview-${entryNumber}`);
            
            const imageDiv = document.createElement('div');
            imageDiv.className = 'image-item';
            
            imageDiv.innerHTML = `
                <img src="${imageInfo.src}" alt="${imageInfo.name}">
                <button class="image-remove" onclick="removeImage(${entryNumber}, ${index})">×</button>
            `;
            
            preview.appendChild(imageDiv);
        }

        function removeImage(entryNumber, index) {
            imageData[entryNumber].splice(index, 1);
            refreshImagePreview(entryNumber);
        }

        function refreshImagePreview(entryNumber) {
            const preview = document.getElementById(`imagePreview-${entryNumber}`);
            preview.innerHTML = '';
            
            if (imageData[entryNumber]) {
                imageData[entryNumber].forEach((imageInfo, index) => {
                    displayImage(entryNumber, imageInfo, index);
                });
            }
        }

        function setupDragAndDrop(uploadDiv, entryNumber) {
            uploadDiv.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadDiv.classList.add('drag-over');
            });
            
            uploadDiv.addEventListener('dragleave', function(e) {
                e.preventDefault();
                uploadDiv.classList.remove('drag-over');
            });
            
            uploadDiv.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadDiv.classList.remove('drag-over');
                
                const files = e.dataTransfer.files;
                const input = document.getElementById(`imageInput-${entryNumber}`);
                input.files = files;
                handleImageUpload(input, entryNumber);
            });
        }

        // Drag & Drop für initial existierenden Upload-Bereich
        document.addEventListener('DOMContentLoaded', function() {
            setupDragAndDrop(document.querySelector('.image-upload'), 1);
        });

        async function generatePDF() {
            const { jsPDF } = window.jspdf;
            const pdf = new jsPDF();
            
            const loadingEl = document.getElementById('loading');
            const successEl = document.getElementById('successMessage');
            
            loadingEl.style.display = 'block';
            
            // Mobile: Scroll zum Loading-Indikator
            scrollToElement(loadingEl);
            
            try {
                // Header
                pdf.setFontSize(18);
                pdf.setFont(undefined, 'bold');
                pdf.text('Filialbesuch Dokumentation', 20, 25);
                
                // Besuchsinformationen
                pdf.setFontSize(11);
                pdf.setFont(undefined, 'normal');
                const visitDate = document.getElementById('visitDate').value;
                const branchName = document.getElementById('branchName').value;
                const visitorName = document.getElementById('visitorName').value;
                const visitTime = document.getElementById('visitTime').value;
                
                let yPos = 40;
                pdf.text(`Datum: ${visitDate}`, 20, yPos);
                pdf.text(`Uhrzeit: ${visitTime}`, 110, yPos);
                yPos += 8;
                pdf.text(`Filiale: ${branchName}`, 20, yPos);
                yPos += 8;
                pdf.text(`Besucher: ${visitorName}`, 20, yPos);
                
                yPos += 15;
                
                // Einträge
                const entries = document.querySelectorAll('.entry-item');
                
                for (let i = 0; i < entries.length; i++) {
                    const entry = entries[i];
                    const entryNumber = entry.getAttribute('data-entry');
                    const text = entry.querySelector('.text-area').value;
                    
                    // Neue Seite wenn nötig
                    if (yPos > 260) {
                        pdf.addPage();
                        yPos = 20;
                    }
                    
                    // Punkt-Header
                    pdf.setFontSize(12);
                    pdf.setFont(undefined, 'bold');
                    pdf.text(`Punkt ${i + 1}:`, 20, yPos);
                    yPos += 8;
                    
                    // Text
                    pdf.setFontSize(10);
                    pdf.setFont(undefined, 'normal');
                    if (text) {
                        const splitText = pdf.splitTextToSize(text, 170);
                        pdf.text(splitText, 20, yPos);
                        yPos += splitText.length * 5;
                    } else {
                        pdf.text('(Keine Notizen)', 20, yPos);
                        yPos += 5;
                    }
                    
                    // Bilder
                    if (imageData[entryNumber] && imageData[entryNumber].length > 0) {
                        yPos += 5;
                        
                        for (let j = 0; j < imageData[entryNumber].length; j++) {
                            const image = imageData[entryNumber][j];
                            
                            // Neue Seite wenn nötig
                            if (yPos > 240) {
                                pdf.addPage();
                                yPos = 20;
                            }
                            
                            try {
                                // Mobile-optimierte Bildgröße
                                const imgWidth = 45;
                                const imgHeight = 35;
                                pdf.addImage(image.src, 'JPEG', 20, yPos, imgWidth, imgHeight);
                                
                                // Bildname daneben
                                pdf.setFontSize(8);
                                pdf.text(image.name, 70, yPos + 8);
                                pdf.setFontSize(10);
                                
                                yPos += imgHeight + 5;
                            } catch (error) {
                                console.log('Fehler beim Hinzufügen des Bildes:', error);
                                pdf.setFontSize(8);
                                pdf.text(`[Bild: ${image.name} - Fehler beim Laden]`, 20, yPos);
                                yPos += 8;
                                pdf.setFontSize(10);
                            }
                        }
                    }
                    
                    yPos += 10;
                }
                
                // PDF herunterladen - mobile-freundlicher Dateiname
                const date = visitDate || new Date().toISOString().split('T')[0];
                const safeBranchName = (branchName || 'Unbekannt').substring(0, 30).replace(/[^\w\s-]/g, '');
                const fileName = `Filialbesuch_${safeBranchName}_${date}.pdf`;
                
                pdf.save(fileName);
                
                // Erfolgsmeldung mit verbesserter mobiler UX
                successEl.style.display = 'block';
                scrollToElement(successEl);
                
                // Haptic Feedback für iOS
                if (window.navigator && window.navigator.vibrate) {
                    window.navigator.vibrate([100, 50, 100]);
                }
                
                setTimeout(() => {
                    successEl.style.display = 'none';
                }, 4000);
                
            } catch (error) {
                alert('Fehler beim Erstellen des PDFs: ' + error.message);
                console.error('PDF Error:', error);
            } finally {
                loadingEl.style.display = 'none';
            }
        }

        function resetForm() {
            // Mobile-optimierte Bestätigung
            const confirmMessage = 'Möchten Sie wirklich alle Eingaben zurücksetzen?\n\nDies kann nicht rückgängig gemacht werden.';
            
            if (confirm(confirmMessage)) {
                // Loading-Indikator für mobile UX
                const loadingEl = document.getElementById('loading');
                loadingEl.innerHTML = '🔄 Formular wird zurückgesetzt...';
                loadingEl.style.display = 'block';
                
                setTimeout(() => {
                    // Alle Einträge außer dem ersten entfernen
                    const entries = document.querySelectorAll('.entry-item');
                    for (let i = entries.length - 1; i > 0; i--) {
                        entries[i].remove();
                    }
                    
                    // Ersten Eintrag zurücksetzen
                    const firstEntry = document.querySelector('.entry-item');
                    const textarea = firstEntry.querySelector('.text-area');
                    const imagePreview = firstEntry.querySelector('.image-preview');
                    
                    textarea.value = '';
                    imagePreview.innerHTML = '';
                    
                    // Besuchsinformationen zurücksetzen
                    document.getElementById('branchName').selectedIndex = 0;
                    // Namen aus Session wiederverwenden, falls vorhanden
                    document.getElementById('visitorName').value = savedVisitorName;
                    
                    // Datum und Zeit auf heute/jetzt setzen
                    document.getElementById('visitDate').valueAsDate = new Date();
                    const now = new Date();
                    document.getElementById('visitTime').value = now.toTimeString().slice(0,5);
                    
                    // Image Data zurücksetzen
                    imageData = {};
                    entryCounter = 1;
                    
                    // Delete-Buttons aktualisieren
                    updateDeleteButtons();
                    
                    // Touch-Feedback neu initialisieren
                    addTouchFeedback();
                    
                    // Zum Anfang scrollen
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                    
                    // Loading ausblenden
                    loadingEl.style.display = 'none';
                    loadingEl.innerHTML = '📄 PDF wird erstellt...';
                    
                    // Haptic Feedback für iOS
                    if (window.navigator && window.navigator.vibrate) {
                        window.navigator.vibrate(100);
                    }
                    
                    // Erfolg anzeigen
                    const successEl = document.getElementById('successMessage');
                    successEl.innerHTML = '✅ Formular erfolgreich zurückgesetzt!';
                    successEl.style.display = 'block';
                    
                    setTimeout(() => {
                        successEl.style.display = 'none';
                        successEl.innerHTML = '✅ PDF erfolgreich erstellt und heruntergeladen!';
                    }, 2000);
                    
                }, 100); // Kurze Verzögerung für bessere UX
            }
        }
    </script>
</body>
</html>